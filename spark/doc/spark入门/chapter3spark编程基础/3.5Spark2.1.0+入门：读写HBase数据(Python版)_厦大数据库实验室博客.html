<!DOCTYPE html>
<html lang="zh-CN"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Spark2.1.0+入门：读写HBase数据(Python版)_厦大数据库实验室博客</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="renderer" content="webkit">
<link rel="dns-prefetch" href="http://cdn.staticfile.org/">
<link rel="dns-prefetch" href="http://s.w.org/">
<link rel="stylesheet" id="yarppWidgetCss-css" href="3.5Spark2.1.0+%E5%85%A5%E9%97%A8%EF%BC%9A%E8%AF%BB%E5%86%99HBase%E6%95%B0%E6%8D%AE(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/widget.css" type="text/css" media="all">
<link rel="stylesheet" id="wp-quicklatex-format-css" href="3.5Spark2.1.0+%E5%85%A5%E9%97%A8%EF%BC%9A%E8%AF%BB%E5%86%99HBase%E6%95%B0%E6%8D%AE(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/quicklatex-format.css" type="text/css" media="all">
<link rel="stylesheet" id="bootstrap-css" href="3.5Spark2.1.0+%E5%85%A5%E9%97%A8%EF%BC%9A%E8%AF%BB%E5%86%99HBase%E6%95%B0%E6%8D%AE(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/bootstrap.css" type="text/css" media="all">
<link rel="stylesheet" id="font-awesome-css" href="3.5Spark2.1.0+%E5%85%A5%E9%97%A8%EF%BC%9A%E8%AF%BB%E5%86%99HBase%E6%95%B0%E6%8D%AE(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/font-awesome.css" type="text/css" media="all">
<link rel="stylesheet" id="power-css" href="3.5Spark2.1.0+%E5%85%A5%E9%97%A8%EF%BC%9A%E8%AF%BB%E5%86%99HBase%E6%95%B0%E6%8D%AE(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/style.css" type="text/css" media="all">
<link rel="stylesheet" id="google-code-prettify-css" href="3.5Spark2.1.0+%E5%85%A5%E9%97%A8%EF%BC%9A%E8%AF%BB%E5%86%99HBase%E6%95%B0%E6%8D%AE(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/prettify.css" type="text/css" media="all">
<script type="text/javascript" async="" charset="utf-8" src="3.5Spark2.1.0+%E5%85%A5%E9%97%A8%EF%BC%9A%E8%AF%BB%E5%86%99HBase%E6%95%B0%E6%8D%AE(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/core.js"></script><script src="3.5Spark2.1.0+%E5%85%A5%E9%97%A8%EF%BC%9A%E8%AF%BB%E5%86%99HBase%E6%95%B0%E6%8D%AE(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/hm.js"></script><script src="3.5Spark2.1.0+%E5%85%A5%E9%97%A8%EF%BC%9A%E8%AF%BB%E5%86%99HBase%E6%95%B0%E6%8D%AE(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/z_stat.js"></script><script type="text/javascript" src="3.5Spark2.1.0+%E5%85%A5%E9%97%A8%EF%BC%9A%E8%AF%BB%E5%86%99HBase%E6%95%B0%E6%8D%AE(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/jquery_002.js"></script>
<script type="text/javascript" src="3.5Spark2.1.0+%E5%85%A5%E9%97%A8%EF%BC%9A%E8%AF%BB%E5%86%99HBase%E6%95%B0%E6%8D%AE(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/jquery.js"></script>
<script type="text/javascript" src="3.5Spark2.1.0+%E5%85%A5%E9%97%A8%EF%BC%9A%E8%AF%BB%E5%86%99HBase%E6%95%B0%E6%8D%AE(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/jquery-migrate.js"></script>
<script type="text/javascript" src="3.5Spark2.1.0+%E5%85%A5%E9%97%A8%EF%BC%9A%E8%AF%BB%E5%86%99HBase%E6%95%B0%E6%8D%AE(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/wp-quicklatex-frontend.js"></script>
<link rel="https://api.w.org/" href="http://dblab.xmu.edu.cn/blog/wp-json/">
<link rel="prev" title="Spark 2.0分布式集群环境搭建(Python版)" href="http://dblab.xmu.edu.cn/blog/1714-2/">
<link rel="next" title="Python：数据类型" href="http://dblab.xmu.edu.cn/blog/1716-2/">
<link rel="canonical" href="http://dblab.xmu.edu.cn/blog/1715-2/">
<link rel="alternate" type="application/json+oembed" href="http://dblab.xmu.edu.cn/blog/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fdblab.xmu.edu.cn%2Fblog%2F1715-2%2F">
<!--[if lt IE 9]>
<script src="http://dblab.xmu.edu.cn/blog/wp-content/themes/power/js/html5shiv.js"></script>
<![endif]-->
</head>

<body class="post-template-default single single-post postid-1715 single-format-standard group-blog">
<div class="container site-page">

<div class="row">
	<div class="col-sm-3 site-infos">
		<h4 class="site-title">
			<a href="http://dblab.xmu.edu.cn/blog/" title="厦大数据库实验室博客" rel="home">厦大数据库实验室博客</a>
		</h4>
		<div class="site-description">总结、分享、收获<p><a href="http://dblab.xmu.edu.cn/" title="厦大数据库实验室">实验室主页</a></p></div>

		<nav class="main-navigation" role="navigation">
			<div class="menu-primary-container"><ul id="menu-primary" class="menu menu-level-1"><li id="menu-item-80" class="menu-item item-level-1"><a href="http://dblab.xmu.edu.cn/blog/">首页</a></li>
<li id="menu-item-85" class="menu-item item-level-1 current-path"><a href="http://dblab.xmu.edu.cn/blog/category/big-data/">大数据</a></li>
<li id="menu-item-676" class="menu-item item-level-1"><a href="http://dblab.xmu.edu.cn/blog/category/databases/">数据库</a></li>
<li id="menu-item-87" class="menu-item item-level-1"><a href="http://dblab.xmu.edu.cn/blog/category/data-mining/">数据挖掘</a></li>
<li id="menu-item-86" class="menu-item item-level-1"><a href="http://dblab.xmu.edu.cn/blog/category/others/">其他</a></li>
</ul></div>		</nav><!-- #site-navigation -->

		<div class="search"><form role="search" method="get" class="search-form" action="http://dblab.xmu.edu.cn/blog/">
				<label>
					<span class="screen-reader-text">搜索：</span>
					<input class="search-field" placeholder="搜索…" name="s" type="search">
				</label>
				<input class="search-submit" value="搜索" type="submit">
			</form></div>
	</div>
	<div class="col-sm-9 site-main">

					<article id="post-1715" class="post-1715 post type-post status-publish format-standard hentry category-big-data">
	<header class="entry-header">
		<h1 class="entry-title">Spark2.1.0+入门：读写HBase数据(Python版)</h1>

		<div class="entry-meta">
			<span class="author"><i class="fa fa-user"></i> 阮榕城</span><span class="date"><i class="fa fa-calendar"></i> <time datetime="2017-12-06T15:02:56+00:00">2017年12月6日</time> <span class="updated">(updated: <time class="updated" datetime="2017-12-19T20:14:13+00:00">2017年12月19日</time>)</span></span><span class="views" id="views"><i class="fa fa-eye"></i> 7123</span>		</div><!-- .entry-meta -->
	</header><!-- .entry-header -->

	<div class="entry-content">
		<div class="bigdata-book">
			<a href="http://dblab.xmu.edu.cn/post/5899/" title="2019年1月20日寒假大数据师资培训班" target="_blank"><img src="3.5Spark2.1.0+%E5%85%A5%E9%97%A8%EF%BC%9A%E8%AF%BB%E5%86%99HBase%E6%95%B0%E6%8D%AE(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/peixunban2019-01-20.jpg" alt="2019年1月20日寒假大数据师资培训班"></a>
		</div>
		<p>【版权声明】博客内容由厦门大学数据库实验室拥有版权，未经允许，请勿转载！<br>
<a href="http://dblab.xmu.edu.cn/blog/1709-2/" target="_blank">返回Spark教程首页</a></p>
<p>Spark处理的数据有很多是存放在HBase数据库中的，所以，我们需要学会如何读写HBase数据库。HBase是针对谷歌BigTable的
开源实现，是一个高可靠、高性能、面向列、可伸缩的分布式数据库，主要用来存储非结构化和半结构化的松散数据。HBase可以支持超大规模数据存储，它可
以通过水平扩展的方式，利用廉价计算机集群处理由超过10亿行数据和数百万列元素组成的数据表。如果要了解HBase的技术原理和使用方法，可以参考<a href="http://dblab.xmu.edu.cn/post/bigdata-online-course/#lesson4" target="_blank">厦门大学数据库实验室的在线课程《HBase数据库》</a>。</p>
<p><span id="more-1715"></span></p>
<h1>准备工作一：创建一个HBase表</h1>
<p>这里依然是以student表为例进行演示。这里假设你已经成功安装了HBase数据库，如果你还没有安装，可以参考<a href="http://dblab.xmu.edu.cn/blog/install-hbase/" target="_blank">厦门大学数据库实验室HBase安装和使用教程</a>，进行安装，安装好以后，不要创建数据库和表，只要跟着本节后面的内容操作即可。HBase安装时有三种模式：单机模式、伪分布式模式和分布式模式。本教程采用伪分布式安装。<br>
安装好了伪分布式模式的HBase以后，我们可以在里面创建一个student表。<br>
请登录Linux系统，打开一个终端（可以使用快捷方式Ctrl+Alt+T组合键打开终端），因为HBase是伪分布式模式，需要调用HDFS，所以，请首先在终端中输入下面命令启动Hadoop：</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-bash prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="kwd">cd </span><span class="pln">/usr/local/hadoop</span></li><li class="L1"><span class="pln">./sbin/start-all.sh</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Shell 命令</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>启动完成以后，一定要输入jps命令查看是否启动成功：</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-bash prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="pln">jps</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Shell 命令</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>运行jps命令以后，应该可以看到以下几个进程：</p>
<pre><code>2375 SecondaryNameNode
2169 DataNode
2667 NodeManager
2972 Jps
2045 NameNode
2541 ResourceManager
</code></pre>
<p>如果少了其中一个进程，说明启动失败。<br>
下面就可以启动HBase，命令如下：</p>
<pre><code>cd /usr/local/hbase
./bin/start-hbase.sh //启动HBase
./bin/hbase shell  //启动hbase shell
</code></pre>
<p>这样就可以进入hbase shell命令提示符状态。下面我们在HBase数据库中创建student表（注意：在关系型数据库MySQL中，需要首先创建数据库，然后再创建表，但是，在HBase数据库中，不需要创建数据库，只要直接创建表就可以）：</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-hbase prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="pln">hbase</span><span class="pun">&gt;</span><span class="pln"> list</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">hbase</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>用list命令可以显示当前HBase数据库中有哪些已经创建好的表，如果里面已经有一个名称为student的表，请使用如下命令删除（如果不存在student表，就不用执行下面的删除命令了）：</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-hbase prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="pln">hbase</span><span class="pun">&gt;</span><span class="pln"> disable </span><span class="str">'student'</span></li><li class="L1"><span class="pln">hbase</span><span class="pun">&gt;</span><span class="pln"> drop </span><span class="str">'student'</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">hbase</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>下面让我们一起来创建一个student表，我们要在这个表中录入如下数据：</p>
<pre><code>+------+----------+--------+------+
| id   | name     | gender | age  |
+------+----------+--------+------+
|    1 | Xueqian  | F      |   23 |
|    2 | Weiliang | M      |   24 |
+------+----------+--------+------+
</code></pre>
<p>我们可以在hbase shell中使用下面命令创建：</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-hbase prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="pln">hbase</span><span class="pun">&gt;</span><span class="pln">  create </span><span class="str">'student'</span><span class="pun">,</span><span class="str">'info'</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">hbase</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>你可以发现，我们在创建student表的create命令中，命令后面首先跟上表名称’student’，然后，再跟上列族名称’info’，这
个列族’info’中包含三个列’name’,’gender’,’age’。你会发现，好像没有’id’字段，这是因为HBase的表中会有一个系统默
认的属性作为行键，无需自行创建，默认把put命令操作中跟在表名后的第一个字段作为行健。<br>
创建完“student”表后，可通过describe命令查看“student”表的基本信息：</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-hbase prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="pln">hbase</span><span class="pun">&gt;</span><span class="pln"> describe </span><span class="str">'student'</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">hbase</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>下面，我们要把student表的两个样例记录输入到student表中。但是，HBase是列族数据库，原理和关系数据库不同，操作方法也不同。如果要了解HBase的技术原理和使用方法，可以参考<a href="http://dblab.xmu.edu.cn/post/bigdata-online-course/#lesson4" target="_blank">厦门大学数据库实验室的在线课程《HBase数据库》</a>。<br>
如果没有时间学习HBase数据库细节知识，也可以直接按照下面的内容跟着操作就可以了。<br>
HBase中用put命令添加数据，注意：一次只能为一个表的一行数据的一个列（也就是一个单元格，单元格是HBase中的概念）添加一个数据，所以直接
用shell命令插入数据效率很低，在实际应用中，一般都是利用编程操作数据。因为这里只要插入两条学生记录，所以，我们可以用shell命令手工插入。</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-hbase prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="com">//首先录入student表的第一个学生记录</span></li><li class="L1"><span class="pln">hbase</span><span class="pun">&gt;</span><span class="pln"> put </span><span class="str">'student'</span><span class="pun">,</span><span class="str">'1'</span><span class="pun">,</span><span class="str">'info:name'</span><span class="pun">,</span><span class="str">'Xueqian'</span></li><li class="L2"><span class="pln">hbase</span><span class="pun">&gt;</span><span class="pln"> put </span><span class="str">'student'</span><span class="pun">,</span><span class="str">'1'</span><span class="pun">,</span><span class="str">'info:gender'</span><span class="pun">,</span><span class="str">'F'</span></li><li class="L3"><span class="pln">hbase</span><span class="pun">&gt;</span><span class="pln"> put </span><span class="str">'student'</span><span class="pun">,</span><span class="str">'1'</span><span class="pun">,</span><span class="str">'info:age'</span><span class="pun">,</span><span class="str">'23'</span></li><li class="L4"><span class="com">//然后录入student表的第二个学生记录</span></li><li class="L5"><span class="pln">hbase</span><span class="pun">&gt;</span><span class="pln"> put </span><span class="str">'student'</span><span class="pun">,</span><span class="str">'2'</span><span class="pun">,</span><span class="str">'info:name'</span><span class="pun">,</span><span class="str">'Weiliang'</span></li><li class="L6"><span class="pln">hbase</span><span class="pun">&gt;</span><span class="pln"> put </span><span class="str">'student'</span><span class="pun">,</span><span class="str">'2'</span><span class="pun">,</span><span class="str">'info:gender'</span><span class="pun">,</span><span class="str">'M'</span></li><li class="L7"><span class="pln">hbase</span><span class="pun">&gt;</span><span class="pln"> put </span><span class="str">'student'</span><span class="pun">,</span><span class="str">'2'</span><span class="pun">,</span><span class="str">'info:age'</span><span class="pun">,</span><span class="str">'24'</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">hbase</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>数据录入结束后，可以用下面命令查看刚才已经录入的数据：</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-hbase prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="com">//如果每次只查看一行，就用下面命令</span></li><li class="L1"><span class="pln">hbase</span><span class="pun">&gt;</span><span class="pln"> </span><span class="kwd">get</span><span class="pln"> </span><span class="str">'student'</span><span class="pun">,</span><span class="str">'1'</span></li><li class="L2"><span class="com">//如果每次查看全部数据，就用下面命令</span></li><li class="L3"><span class="pln">hbase</span><span class="pun">&gt;</span><span class="pln"> scan </span><span class="str">'student'</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">hbase</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>可以得到如下结果：</p>
<pre><code>ROW                                    COLUMN+CELL                                                                                                   
 1                                     column=info:age, timestamp=1479640712163, value=23                                                            
 1                                     column=info:gender, timestamp=1479640704522, value=F                                                          
 1                                     column=info:name, timestamp=1479640696132, value=Xueqian                                                      
 2                                     column=info:age, timestamp=1479640752474, value=24                                                            
 2                                     column=info:gender, timestamp=1479640745276, value=M                                                          
 2                                     column=info:name, timestamp=1479640732763, value=Weiliang                                                     
2 row(s) in 0.1610 seconds
</code></pre>
<h1>准备工作二：配置Spark</h1>
<p>在开始编程操作HBase数据库之前，需要对做一些准备工作。<br>
（1）请新建一个终端，执行下面命令，把HBase的lib目录下的一些jar文件拷贝到Spark中，这些都是编程时需要引入的jar包，需要拷贝的
jar文件包括：所有hbase开头的jar文件、guava-12.0.1.jar、htrace-core-3.1.0-
incubating.jar和protobuf-java-2.5.0.jar，可以打开一个终端按照以下命令来操作：</p>
<p>然后，设置Spark的spark-env.sh文件，告诉Spark可以在哪个路径下找到HBase相关的jar文件，如下：</p>
<pre><code>cd /usr/local/spark/conf
vim spark-env.sh
</code></pre>
<p>需要注意：在Spark 2.0版本上缺少相关把hbase的数据转换python可读取的jar包，需要我们另行下载。<br>
打开<a href="https://mvnrepository.com/artifact/org.apache.spark/spark-examples_2.11/1.6.0-typesafe-001" target="_blank">spark-example-1.6.0.jar</a>下载jar包<br>
然后执行如下命令</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-bash prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="kwd">mkdir </span><span class="pln">-p /usr/local/spark/jars/hbase/</span></li><li class="L1"><span class="kwd">mv </span><span class="pln">~/下载/spark-examples* /usr/local/spark/jars/hbase/</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Shell 命令</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>使用vim编辑器打开spark-env.sh文件以后，可以在文件最前面增加下面一行内容：</p>
<pre><code>export SPARK_DIST_CLASSPATH=$(/usr/local/hadoop/bin/hadoop classpath):$(/usr/local/hbase/bin/hbase classpath):/usr/local/spark/jars/hbase/*
</code></pre>
<p>只有这样，后面编译和运行过程才不会出错。</p>
<h1>编写程序读取HBase数据</h1>
<p>如果要让Spark读取HBase，就需要使用SparkContext提供的newAPIHadoopRDD API将表的内容以RDD的形式加载到Spark中。<br>
请在Linux系统中打开一个终端，然后执行以下命令：</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-bash prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="pln">pyspark</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Shell 命令</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>启动pyspark<br>
然后输入如下代码：</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-python prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="pln">host </span><span class="pun">=</span><span class="pln"> </span><span class="str">'localhost'</span></li><li class="L1"><span class="pln">table </span><span class="pun">=</span><span class="pln"> </span><span class="str">'student'</span></li><li class="L2"><span class="pln">conf </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="str">"hbase.zookeeper.quorum"</span><span class="pun">:</span><span class="pln"> host</span><span class="pun">,</span><span class="pln"> </span><span class="str">"hbase.mapreduce.inputtable"</span><span class="pun">:</span><span class="pln"> table</span><span class="pun">}</span></li><li class="L3"><span class="pln">keyConv </span><span class="pun">=</span><span class="pln"> </span><span class="str">"org.apache.spark.examples.pythonconverters.ImmutableBytesWritableToStringConverter"</span></li><li class="L4"><span class="pln">valueConv </span><span class="pun">=</span><span class="pln"> </span><span class="str">"org.apache.spark.examples.pythonconverters.HBaseResultToStringConverter"</span></li><li class="L5"><span class="pln">hbase_rdd </span><span class="pun">=</span><span class="pln"> sc</span><span class="pun">.</span><span class="pln">newAPIHadoopRDD</span><span class="pun">(</span><span class="str">"org.apache.hadoop.hbase.mapreduce.TableInputFormat"</span><span class="pun">,</span><span class="str">"org.apache.hadoop.hbase.io.ImmutableBytesWritable"</span><span class="pun">,</span><span class="str">"org.apache.hadoop.hbase.client.Result"</span><span class="pun">,</span><span class="pln">keyConverter</span><span class="pun">=</span><span class="pln">keyConv</span><span class="pun">,</span><span class="pln">valueConverter</span><span class="pun">=</span><span class="pln">valueConv</span><span class="pun">,</span><span class="pln">conf</span><span class="pun">=</span><span class="pln">conf</span><span class="pun">)</span></li><li class="L6"><span class="pln">count </span><span class="pun">=</span><span class="pln"> hbase_rdd</span><span class="pun">.</span><span class="pln">count</span><span class="pun">()</span></li><li class="L7"><span class="pln">hbase_rdd</span><span class="pun">.</span><span class="pln">cache</span><span class="pun">()</span></li><li class="L8"><span class="pln">output </span><span class="pun">=</span><span class="pln"> hbase_rdd</span><span class="pun">.</span><span class="pln">collect</span><span class="pun">()</span></li><li class="L9"><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">k</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> output</span><span class="pun">:</span></li><li class="L0"><span class="pln">        </span><span class="kwd">print</span><span class="pln"> </span><span class="pun">(</span><span class="pln">k</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">)</span></li><li class="L1"><span class="pln">&nbsp;</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="lit">1</span><span class="pln"> </span><span class="pun">{</span><span class="str">"qualifier"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"age"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"timestamp"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"1512549772307"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"columnFamily"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"info"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"row"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"1"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"type"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"Put"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"value"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"23"</span><span class="pun">}</span></li><li class="L4"><span class="pun">{</span><span class="str">"qualifier"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"gender"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"timestamp"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"1512549765192"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"columnFamily"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"info"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"row"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"1"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"type"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"Put"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"value"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"F"</span><span class="pun">}</span></li><li class="L5"><span class="pun">{</span><span class="str">"qualifier"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"timestamp"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"1512549757406"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"columnFamily"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"info"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"row"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"1"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"type"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"Put"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"value"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"Xueqian"</span><span class="pun">}</span></li><li class="L6"><span class="lit">2</span><span class="pln"> </span><span class="pun">{</span><span class="str">"qualifier"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"age"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"timestamp"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"1512549829145"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"columnFamily"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"info"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"row"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"2"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"type"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"Put"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"value"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"24"</span><span class="pun">}</span></li><li class="L7"><span class="pun">{</span><span class="str">"qualifier"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"gender"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"timestamp"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"1512549790422"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"columnFamily"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"info"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"row"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"2"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"type"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"Put"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"value"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"M"</span><span class="pun">}</span></li><li class="L8"><span class="pun">{</span><span class="str">"qualifier"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"timestamp"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"1512549780044"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"columnFamily"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"info"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"row"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"2"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"type"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"Put"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"value"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"Weiliang"</span><span class="pun">}</span><span class="pln">               </span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Python</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<h1>编写程序向HBase写入数据</h1>
<p>启动pyspark，然后在pyspark shell中输入如下代码：</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-python prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="pln">host </span><span class="pun">=</span><span class="pln"> </span><span class="str">'localhost'</span></li><li class="L1"><span class="pln">table </span><span class="pun">=</span><span class="pln"> </span><span class="str">'student'</span></li><li class="L2"><span class="pln">keyConv </span><span class="pun">=</span><span class="pln"> </span><span class="str">"org.apache.spark.examples.pythonconverters.StringToImmutableBytesWritableConverter"</span></li><li class="L3"><span class="pln">valueConv </span><span class="pun">=</span><span class="pln"> </span><span class="str">"org.apache.spark.examples.pythonconverters.StringListToPutConverter"</span></li><li class="L4"><span class="pln">conf </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="str">"hbase.zookeeper.quorum"</span><span class="pun">:</span><span class="pln"> host</span><span class="pun">,</span><span class="str">"hbase.mapred.outputtable"</span><span class="pun">:</span><span class="pln"> table</span><span class="pun">,</span><span class="str">"mapreduce.outputformat.class"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"org.apache.hadoop.hbase.mapreduce.TableOutputFormat"</span><span class="pun">,</span><span class="str">"mapreduce.job.output.key.class"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"org.apache.hadoop.hbase.io.ImmutableBytesWritable"</span><span class="pun">,</span><span class="str">"mapreduce.job.output.value.class"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"org.apache.hadoop.io.Writable"</span><span class="pun">}</span></li><li class="L5"><span class="pln">&nbsp;</span></li><li class="L6"><span class="pln">rawData </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'3,info,name,Rongcheng'</span><span class="pun">,</span><span class="str">'4,info,name,Guanhua'</span><span class="pun">]</span></li><li class="L7"><span class="pun">//</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> rowkey </span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="pln"> row key </span><span class="pun">,</span><span class="pln"> column family </span><span class="pun">,</span><span class="pln"> column name </span><span class="pun">,</span><span class="pln"> value </span><span class="pun">]</span><span class="pln"> </span><span class="pun">)</span></li><li class="L8"><span class="pln">sc</span><span class="pun">.</span><span class="pln">parallelize</span><span class="pun">(</span><span class="pln">rawData</span><span class="pun">).</span><span class="pln">map</span><span class="pun">(</span><span class="kwd">lambda</span><span class="pln"> x</span><span class="pun">:</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x</span><span class="pun">[</span><span class="lit">0</span><span class="pun">],</span><span class="pln">x</span><span class="pun">.</span><span class="pln">split</span><span class="pun">(</span><span class="str">','</span><span class="pun">))).</span><span class="pln">saveAsNewAPIHadoopDataset</span><span class="pun">(</span><span class="pln">conf</span><span class="pun">=</span><span class="pln">conf</span><span class="pun">,</span><span class="pln">keyConverter</span><span class="pun">=</span><span class="pln">keyConv</span><span class="pun">,</span><span class="pln">valueConverter</span><span class="pun">=</span><span class="pln">valueConv</span><span class="pun">)</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Python</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>此处发现执行后，pyspark会报如下错误，但是数据仍会插入到hbase中.</p>
<pre><code>pyspark.sql.utils.IllegalArgumentException: 'Can not create a Path from a null string'
</code></pre>
<p>执行后，我们可以切换到刚才的HBase终端窗口，在HBase shell中输入如下命令查看结果：</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-hbase prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="pln">hbase</span><span class="pun">&gt;</span><span class="pln"> scan </span><span class="str">'student'</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">hbase</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>就能查看到新增的数据</p>
			</div><!-- .entry-content -->

	<footer class="entry-footer">
		<div class="entry-author">
			<div class="author-title">本文作者</div>
			
		<div class="author-avatar"><img src="3.5Spark2.1.0+%E5%85%A5%E9%97%A8%EF%BC%9A%E8%AF%BB%E5%86%99HBase%E6%95%B0%E6%8D%AE(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/2.jpg" alt="阮榕城" class="avatar avatar-thumbnail wp-user-avatar wp-user-avatar-thumbnail alignnone photo"></div>
		<div class="author-info">
			<p class="author-name"><a href="http://dblab.xmu.edu.cn/blog/author/ruanrongcheng/">阮榕城</a></p>
			<p class="author-desc">磨人的小妖精！</p>
			<p class="author-contact"><a href="http://www.nekomiao.me/" target="_blank" title="个人主页" class="homepage"><i class="fa fa-home"></i>www.nekomiao.me</a><i class="fa fa-envelope"></i><span class="envelope">moc.qq@crnaur</span></p>
		</div>
			</div>
		<div class="entry-info">
			<span class="permalink"><i class="fa fa-external-link"></i> <a href="http://dblab.xmu.edu.cn/blog/1715-2/" title="Spark2.1.0+入门：读写HBase数据(Python版)">http://dblab.xmu.edu.cn/blog/1715-2/</a></span><span class="category"><i class="fa fa-folder-open-o"></i> <a href="http://dblab.xmu.edu.cn/blog/category/big-data/" rel="category tag">大数据</a></span>		</div>
		<div class="yarpp-related yarpp-related-none">
</div>
	</footer><!-- .entry-footer -->
</article><!-- #post-## -->
			</div>
</div><!-- .row -->

	<div class="row">
		<div class="col-sm-3"></div>
		<div class="col-sm-9 site-footer">
			© 2014 <a href="http://dblab.xmu.edu.cn/">厦大数据库实验室</a>
					</div>
	</div>
</div><!-- .container -->
<link rel="stylesheet" id="yarppRelatedCss-css" href="3.5Spark2.1.0+%E5%85%A5%E9%97%A8%EF%BC%9A%E8%AF%BB%E5%86%99HBase%E6%95%B0%E6%8D%AE(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/related.css" type="text/css" media="all">
<script type="text/javascript" src="3.5Spark2.1.0+%E5%85%A5%E9%97%A8%EF%BC%9A%E8%AF%BB%E5%86%99HBase%E6%95%B0%E6%8D%AE(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/prettify.js"></script>
<script type="text/javascript" src="3.5Spark2.1.0+%E5%85%A5%E9%97%A8%EF%BC%9A%E8%AF%BB%E5%86%99HBase%E6%95%B0%E6%8D%AE(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/power.js"></script>
<script type="text/javascript" src="3.5Spark2.1.0+%E5%85%A5%E9%97%A8%EF%BC%9A%E8%AF%BB%E5%86%99HBase%E6%95%B0%E6%8D%AE(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/wp-embed.js"></script>

<div class="back-to-top" id="back-to-top" title="嗖的就上去了！" style="display: block;"><span><i class="fa fa-chevron-up"></i></span></div></body></html>