<!DOCTYPE html>
<html lang="zh-CN"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Spark 2.1.0 入门：协同过滤算法(Python版)_厦大数据库实验室博客</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="renderer" content="webkit">
<link rel="dns-prefetch" href="http://cdn.staticfile.org/">
<link rel="dns-prefetch" href="http://s.w.org/">
<link rel="stylesheet" id="yarppWidgetCss-css" href="6.6.1Spark%202.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E5%8D%8F%E5%90%8C%E8%BF%87%E6%BB%A4%E7%AE%97%E6%B3%95(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/widget.css" type="text/css" media="all">
<link rel="stylesheet" id="wp-quicklatex-format-css" href="6.6.1Spark%202.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E5%8D%8F%E5%90%8C%E8%BF%87%E6%BB%A4%E7%AE%97%E6%B3%95(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/quicklatex-format.css" type="text/css" media="all">
<link rel="stylesheet" id="bootstrap-css" href="6.6.1Spark%202.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E5%8D%8F%E5%90%8C%E8%BF%87%E6%BB%A4%E7%AE%97%E6%B3%95(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/bootstrap.css" type="text/css" media="all">
<link rel="stylesheet" id="font-awesome-css" href="6.6.1Spark%202.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E5%8D%8F%E5%90%8C%E8%BF%87%E6%BB%A4%E7%AE%97%E6%B3%95(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/font-awesome.css" type="text/css" media="all">
<link rel="stylesheet" id="power-css" href="6.6.1Spark%202.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E5%8D%8F%E5%90%8C%E8%BF%87%E6%BB%A4%E7%AE%97%E6%B3%95(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/style.css" type="text/css" media="all">
<link rel="stylesheet" id="google-code-prettify-css" href="6.6.1Spark%202.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E5%8D%8F%E5%90%8C%E8%BF%87%E6%BB%A4%E7%AE%97%E6%B3%95(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/prettify.css" type="text/css" media="all">
<script type="text/javascript" async="" charset="utf-8" src="6.6.1Spark%202.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E5%8D%8F%E5%90%8C%E8%BF%87%E6%BB%A4%E7%AE%97%E6%B3%95(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/core.js"></script><script src="6.6.1Spark%202.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E5%8D%8F%E5%90%8C%E8%BF%87%E6%BB%A4%E7%AE%97%E6%B3%95(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/hm.js"></script><script src="6.6.1Spark%202.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E5%8D%8F%E5%90%8C%E8%BF%87%E6%BB%A4%E7%AE%97%E6%B3%95(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/z_stat.js"></script><script type="text/javascript" src="6.6.1Spark%202.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E5%8D%8F%E5%90%8C%E8%BF%87%E6%BB%A4%E7%AE%97%E6%B3%95(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/jquery_002.js"></script>
<script type="text/javascript" src="6.6.1Spark%202.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E5%8D%8F%E5%90%8C%E8%BF%87%E6%BB%A4%E7%AE%97%E6%B3%95(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/jquery.js"></script>
<script type="text/javascript" src="6.6.1Spark%202.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E5%8D%8F%E5%90%8C%E8%BF%87%E6%BB%A4%E7%AE%97%E6%B3%95(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/jquery-migrate.js"></script>
<script type="text/javascript" src="6.6.1Spark%202.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E5%8D%8F%E5%90%8C%E8%BF%87%E6%BB%A4%E7%AE%97%E6%B3%95(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/wp-quicklatex-frontend.js"></script>
<link rel="https://api.w.org/" href="http://dblab.xmu.edu.cn/blog/wp-json/">
<link rel="prev" title="Spark 2.1.0 入门：高斯混合模型(GMM)聚类算法(Python版)" href="http://dblab.xmu.edu.cn/blog/1780-2/">
<link rel="next" title="Spark2.1.0入门：模型选择和超参数调整(Python版)" href="http://dblab.xmu.edu.cn/blog/1782-2/">
<link rel="canonical" href="http://dblab.xmu.edu.cn/blog/1781-2/">
<link rel="alternate" type="application/json+oembed" href="http://dblab.xmu.edu.cn/blog/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fdblab.xmu.edu.cn%2Fblog%2F1781-2%2F">
<!--[if lt IE 9]>
<script src="http://dblab.xmu.edu.cn/blog/wp-content/themes/power/js/html5shiv.js"></script>
<![endif]-->
</head>

<body class="post-template-default single single-post postid-1781 single-format-standard group-blog">
<div class="container site-page">

<div class="row">
	<div class="col-sm-3 site-infos">
		<h4 class="site-title">
			<a href="http://dblab.xmu.edu.cn/blog/" title="厦大数据库实验室博客" rel="home">厦大数据库实验室博客</a>
		</h4>
		<div class="site-description">总结、分享、收获<p><a href="http://dblab.xmu.edu.cn/" title="厦大数据库实验室">实验室主页</a></p></div>

		<nav class="main-navigation" role="navigation">
			<div class="menu-primary-container"><ul id="menu-primary" class="menu menu-level-1"><li id="menu-item-80" class="menu-item item-level-1"><a href="http://dblab.xmu.edu.cn/blog/">首页</a></li>
<li id="menu-item-85" class="menu-item item-level-1 current-path"><a href="http://dblab.xmu.edu.cn/blog/category/big-data/">大数据</a></li>
<li id="menu-item-676" class="menu-item item-level-1"><a href="http://dblab.xmu.edu.cn/blog/category/databases/">数据库</a></li>
<li id="menu-item-87" class="menu-item item-level-1"><a href="http://dblab.xmu.edu.cn/blog/category/data-mining/">数据挖掘</a></li>
<li id="menu-item-86" class="menu-item item-level-1"><a href="http://dblab.xmu.edu.cn/blog/category/others/">其他</a></li>
</ul></div>		</nav><!-- #site-navigation -->

		<div class="search"><form role="search" method="get" class="search-form" action="http://dblab.xmu.edu.cn/blog/">
				<label>
					<span class="screen-reader-text">搜索：</span>
					<input class="search-field" placeholder="搜索…" name="s" type="search">
				</label>
				<input class="search-submit" value="搜索" type="submit">
			</form></div>
	</div>
	<div class="col-sm-9 site-main">

					<article id="post-1781" class="post-1781 post type-post status-publish format-standard hentry category-big-data">
	<header class="entry-header">
		<h1 class="entry-title">Spark 2.1.0 入门：协同过滤算法(Python版)</h1>

		<div class="entry-meta">
			<span class="author"><i class="fa fa-user"></i> 阮榕城</span><span class="date"><i class="fa fa-calendar"></i> <time datetime="2017-12-19T10:35:05+00:00">2017年12月19日</time></span><span class="views" id="views"><i class="fa fa-eye"></i> 2892</span>		</div><!-- .entry-meta -->
	</header><!-- .entry-header -->

	<div class="entry-content">
		<div class="bigdata-book">
			<a href="http://dblab.xmu.edu.cn/post/5899/" title="2019年1月20日寒假大数据师资培训班" target="_blank"><img src="6.6.1Spark%202.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E5%8D%8F%E5%90%8C%E8%BF%87%E6%BB%A4%E7%AE%97%E6%B3%95(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/peixunban2019-01-20.jpg" alt="2019年1月20日寒假大数据师资培训班"></a>
		</div>
		<p>【版权声明】博客内容由厦门大学数据库实验室拥有版权，未经允许，请勿转载！</p>
<p><a href="http://dblab.xmu.edu.cn/blog/1709-2/" target="_blank">返回Spark教程首页</a><br>
<span id="more-1781"></span></p>
<h1>一、方法简介</h1>
<p>​ 协同过滤是一种基于一组兴趣相同的用户或项目进行的推荐，它根据邻居用户(与目标用户兴趣相似的用户)的偏好信息产生对目标用户的推荐列表。</p>
<p>关于协同过滤的一个经典的例子就是看电影。如果你不知道哪一部电影是自己喜欢的或者评分比较高的，那么通常的做法就是问问周围的朋友，看看最近有什
么好的电影推荐。而在问的时候，肯定都习惯于问跟自己口味差不多的朋友，这就是协同过滤的核心思想。因此，协同过滤是在海量数据中挖掘出小部分与你品味类
似的用户，在协同过滤中，这些用户成为邻居，然后根据他们喜欢的东西组织成一个排序的目录推荐给你（如下图所示）。<br>
<img src="6.6.1Spark%202.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E5%8D%8F%E5%90%8C%E8%BF%87%E6%BB%A4%E7%AE%97%E6%B3%95(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/user-item.png" alt=""><br>
协同过滤算法主要分为基于用户的协同过滤算法和基于项目的协同过滤算法。MLlib当前支持基于模型的协同过滤，其中用户和商品通过一小组隐语义因子进行表达，并且这些因子也用于预测缺失的元素。Spark MLlib实现了 <a href="http://dl.acm.org/citation.cfm?id=1608614" target="_blank">交替最小二乘法</a> (ALS) 来学习这些隐性语义因子。</p>
<h1>二、隐性反馈 vs 显性反馈</h1>
<p>显性反馈行为包括用户明确表示对物品喜好的行为，隐性反馈行为指的是那些不能明确反应用户喜好的行为。在许多的现实生活中的很多场景中，我们常常只能接触到隐性的反馈，例如页面游览，点击，购买，喜欢，分享等等。</p>
<p>基于矩阵分解的协同过滤的标准方法，一般将用户商品矩阵中的元素作为用户对商品的显性偏好。在 MLlib 中所用到的处理这种数据的方法来源于文献： <a href="http://dx.doi.org/10.1109/ICDM.2008.22" target="_blank">Collaborative Filtering for Implicit Feedback Datasets </a>。 本质上，这个方法将数据作为二元偏好值和偏好强度的一个结合，而不是对评分矩阵直接进行建模。因此，评价就不是与用户对商品的显性评分，而是与所观察到的用户偏好强度关联起来。然后，这个模型将尝试找到隐语义因子来预估一个用户对一个商品的偏好。</p>
<h1>示例</h1>
<p>下面的例子中，我们将获取MovieLens数据集，其中每行包含一个用户、一个电影、一个该用户对该电影的评分以及时间戳。我们使用默认的
ALS.train() 方法，即显性反馈（默认implicitPrefs 
为false）来构建推荐模型并根据模型对评分预测的均方根误差来对模型进行评估。</p>
<h2>导入需要的包</h2>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-python prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="kwd">from</span><span class="pln"> pyspark</span><span class="pun">.</span><span class="pln">ml</span><span class="pun">.</span><span class="pln">evaluation </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">RegressionEvaluator</span></li><li class="L1"><span class="kwd">from</span><span class="pln"> pyspark</span><span class="pun">.</span><span class="pln">ml</span><span class="pun">.</span><span class="pln">recommendation </span><span class="kwd">import</span><span class="pln"> ALS</span></li><li class="L2"><span class="kwd">from</span><span class="pln"> pyspark</span><span class="pun">.</span><span class="pln">sql </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">Row</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Python</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<h2>根据数据结构创建读取规范</h2>
<p>创建一个函数，返回即[Int, Int, Float, Long]的对象</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-python prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="kwd">def</span><span class="pln"> f</span><span class="pun">(</span><span class="pln">x</span><span class="pun">):</span></li><li class="L1"><span class="pln">    rel </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{}</span></li><li class="L2"><span class="pln">    rel</span><span class="pun">[</span><span class="str">'userId'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> int</span><span class="pun">(</span><span class="pln">x</span><span class="pun">[</span><span class="lit">0</span><span class="pun">])</span></li><li class="L3"><span class="pln">        rel</span><span class="pun">[</span><span class="str">'movieId'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> int</span><span class="pun">(</span><span class="pln">x</span><span class="pun">[</span><span class="lit">1</span><span class="pun">])</span></li><li class="L4"><span class="pln">        rel</span><span class="pun">[</span><span class="str">'rating'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> float</span><span class="pun">(</span><span class="pln">x</span><span class="pun">[</span><span class="lit">2</span><span class="pun">])</span></li><li class="L5"><span class="pln">        rel</span><span class="pun">[</span><span class="str">'timestamp'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> float</span><span class="pun">(</span><span class="pln">x</span><span class="pun">[</span><span class="lit">3</span><span class="pun">])</span></li><li class="L6"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> rel</span></li><li class="L7"><span class="pln">&nbsp;</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Python</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<h2>读取数据</h2>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-python prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="pln">ratings </span><span class="pun">=</span><span class="pln"> sc</span><span class="pun">.</span><span class="pln">textFile</span><span class="pun">(</span><span class="str">"file:///usr/local/spark/data/mllib/als/sample_movielens_ratings.txt"</span><span class="pun">).</span><span class="pln">map</span><span class="pun">(</span><span class="kwd">lambda</span><span class="pln"> line</span><span class="pun">:</span><span class="pln"> line</span><span class="pun">.</span><span class="pln">split</span><span class="pun">(</span><span class="str">'::'</span><span class="pun">)).</span><span class="pln">map</span><span class="pun">(</span><span class="kwd">lambda</span><span class="pln"> p</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Row</span><span class="pun">(**</span><span class="pln">f</span><span class="pun">(</span><span class="pln">p</span><span class="pun">))).</span><span class="pln">toDF</span><span class="pun">()</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Python</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>然后把数据打印出来：</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-python prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="pln">ratings</span><span class="pun">.</span><span class="pln">show</span><span class="pun">()</span></li><li class="L1"><span class="pln">&nbsp;</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="pun">+-------+------+-------------+------+</span></li><li class="L4"><span class="pun">|</span><span class="pln">movieId</span><span class="pun">|</span><span class="pln">rating</span><span class="pun">|</span><span class="pln">    timestamp</span><span class="pun">|</span><span class="pln">userId</span><span class="pun">|</span></li><li class="L5"><span class="pun">+-------+------+-------------+------+</span></li><li class="L6"><span class="pun">|</span><span class="pln">      </span><span class="lit">2</span><span class="pun">|</span><span class="pln">   </span><span class="lit">3.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">     </span><span class="lit">0</span><span class="pun">|</span></li><li class="L7"><span class="pun">|</span><span class="pln">      </span><span class="lit">3</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">     </span><span class="lit">0</span><span class="pun">|</span></li><li class="L8"><span class="pun">|</span><span class="pln">      </span><span class="lit">5</span><span class="pun">|</span><span class="pln">   </span><span class="lit">2.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">     </span><span class="lit">0</span><span class="pun">|</span></li><li class="L9"><span class="pun">|</span><span class="pln">      </span><span class="lit">9</span><span class="pun">|</span><span class="pln">   </span><span class="lit">4.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">     </span><span class="lit">0</span><span class="pun">|</span></li><li class="L0"><span class="pun">|</span><span class="pln">     </span><span class="lit">11</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">     </span><span class="lit">0</span><span class="pun">|</span></li><li class="L1"><span class="pun">|</span><span class="pln">     </span><span class="lit">12</span><span class="pun">|</span><span class="pln">   </span><span class="lit">2.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">     </span><span class="lit">0</span><span class="pun">|</span></li><li class="L2"><span class="pun">|</span><span class="pln">     </span><span class="lit">15</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">     </span><span class="lit">0</span><span class="pun">|</span></li><li class="L3"><span class="pun">|</span><span class="pln">     </span><span class="lit">17</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">     </span><span class="lit">0</span><span class="pun">|</span></li><li class="L4"><span class="pun">|</span><span class="pln">     </span><span class="lit">19</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">     </span><span class="lit">0</span><span class="pun">|</span></li><li class="L5"><span class="pun">|</span><span class="pln">     </span><span class="lit">21</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">     </span><span class="lit">0</span><span class="pun">|</span></li><li class="L6"><span class="pun">|</span><span class="pln">     </span><span class="lit">23</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">     </span><span class="lit">0</span><span class="pun">|</span></li><li class="L7"><span class="pun">|</span><span class="pln">     </span><span class="lit">26</span><span class="pun">|</span><span class="pln">   </span><span class="lit">3.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">     </span><span class="lit">0</span><span class="pun">|</span></li><li class="L8"><span class="pun">|</span><span class="pln">     </span><span class="lit">27</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">     </span><span class="lit">0</span><span class="pun">|</span></li><li class="L9"><span class="pun">|</span><span class="pln">     </span><span class="lit">28</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">     </span><span class="lit">0</span><span class="pun">|</span></li><li class="L0"><span class="pun">|</span><span class="pln">     </span><span class="lit">29</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">     </span><span class="lit">0</span><span class="pun">|</span></li><li class="L1"><span class="pun">|</span><span class="pln">     </span><span class="lit">30</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">     </span><span class="lit">0</span><span class="pun">|</span></li><li class="L2"><span class="pun">|</span><span class="pln">     </span><span class="lit">31</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">     </span><span class="lit">0</span><span class="pun">|</span></li><li class="L3"><span class="pun">|</span><span class="pln">     </span><span class="lit">34</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">     </span><span class="lit">0</span><span class="pun">|</span></li><li class="L4"><span class="pun">|</span><span class="pln">     </span><span class="lit">37</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">     </span><span class="lit">0</span><span class="pun">|</span></li><li class="L5"><span class="pun">|</span><span class="pln">     </span><span class="lit">41</span><span class="pun">|</span><span class="pln">   </span><span class="lit">2.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">     </span><span class="lit">0</span><span class="pun">|</span></li><li class="L6"><span class="pun">+-------+------+-------------+------+</span></li><li class="L7"><span class="pln">only showing top </span><span class="lit">20</span><span class="pln"> rows</span></li><li class="L8"><span class="pln">&nbsp;</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Python</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<h2>构建模型</h2>
<p>把MovieLens数据集划分训练集和测试集</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-python prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="pln">training</span><span class="pun">,</span><span class="pln"> test </span><span class="pun">=</span><span class="pln"> ratings</span><span class="pun">.</span><span class="pln">randomSplit</span><span class="pun">([</span><span class="lit">0.8</span><span class="pun">,</span><span class="lit">0.2</span><span class="pun">])</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Python</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>使用ALS来建立推荐模型，这里我们构建了两个模型，一个是显性反馈，一个是隐性反馈</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-python prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="pln">alsExplicit  </span><span class="pun">=</span><span class="pln"> ALS</span><span class="pun">(</span><span class="pln">maxIter</span><span class="pun">=</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> regParam</span><span class="pun">=</span><span class="lit">0.01</span><span class="pun">,</span><span class="pln"> userCol</span><span class="pun">=</span><span class="str">"userId"</span><span class="pun">,</span><span class="pln"> itemCol</span><span class="pun">=</span><span class="str">"movieId"</span><span class="pun">,</span><span class="pln"> ratingCol</span><span class="pun">=</span><span class="str">"rating"</span><span class="pun">)</span></li><li class="L1"><span class="pln">alsImplicit </span><span class="pun">=</span><span class="pln"> ALS</span><span class="pun">(</span><span class="pln">maxIter</span><span class="pun">=</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> regParam</span><span class="pun">=</span><span class="lit">0.01</span><span class="pun">,</span><span class="pln"> implicitPrefs</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">,</span><span class="pln">userCol</span><span class="pun">=</span><span class="str">"userId"</span><span class="pun">,</span><span class="pln"> itemCol</span><span class="pun">=</span><span class="str">"movieId"</span><span class="pun">,</span><span class="pln"> ratingCol</span><span class="pun">=</span><span class="str">"rating"</span><span class="pun">)</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Python</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>在 ML 中的实现有如下的参数:</p>
<p>numBlocks 是用于并行化计算的用户和商品的分块个数 (默认为10)。<br>
rank 是模型中隐语义因子的个数（默认为10）。<br>
maxIter 是迭代的次数（默认为10）。<br>
regParam 是ALS的正则化参数（默认为1.0）。<br>
implicitPrefs 决定了是用显性反馈ALS的版本还是用适用隐性反馈数据集的版本（默认是false，即用显性反馈）。<br>
alpha 是一个针对于隐性反馈 ALS 版本的参数，这个参数决定了偏好行为强度的基准（默认为1.0）。<br>
nonnegative 决定是否对最小二乘法使用非负的限制（默认为false）。<br>
​ 可以调整这些参数，不断优化结果，使均方差变小。比如：imaxIter越大，regParam越 小，均方差会越小，推荐结果较优。</p>
<p>接下来，把推荐模型放在训练数据上训练：</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-python prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="pln">modelExplicit </span><span class="pun">=</span><span class="pln"> alsExplicit</span><span class="pun">.</span><span class="pln">fit</span><span class="pun">(</span><span class="pln">training</span><span class="pun">)</span></li><li class="L1"><span class="pln">modelImplicit </span><span class="pun">=</span><span class="pln"> alsImplicit</span><span class="pun">.</span><span class="pln">fit</span><span class="pun">(</span><span class="pln">training</span><span class="pun">)</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Python</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<h2>模型预测</h2>
<p>使用训练好的推荐模型对测试集中的用户商品进行预测评分，得到预测评分的数据集</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-python prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="pln">predictionsExplicit </span><span class="pun">=</span><span class="pln"> modelExplicit</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">(</span><span class="pln">test</span><span class="pun">)</span></li><li class="L1"><span class="pln">predictionsImplicit </span><span class="pun">=</span><span class="pln"> modelImplicit</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">(</span><span class="pln">test</span><span class="pun">)</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Python</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>我们把结果输出，对比一下真实结果与预测结果：</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-python prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="pln">predictionsExplicit</span><span class="pun">.</span><span class="pln">show</span><span class="pun">()</span></li><li class="L1"><span class="pln">&nbsp;</span></li><li class="L2"><span class="pun">+-------+------+-------------+------+-----------+</span><span class="pln">                               </span></li><li class="L3"><span class="pun">|</span><span class="pln">movieId</span><span class="pun">|</span><span class="pln">rating</span><span class="pun">|</span><span class="pln">    timestamp</span><span class="pun">|</span><span class="pln">userId</span><span class="pun">|</span><span class="pln"> prediction</span><span class="pun">|</span></li><li class="L4"><span class="pun">+-------+------+-------------+------+-----------+</span></li><li class="L5"><span class="pun">|</span><span class="pln">     </span><span class="lit">31</span><span class="pun">|</span><span class="pln">   </span><span class="lit">4.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">12</span><span class="pun">|</span><span class="pln">  </span><span class="lit">1.6642745</span><span class="pun">|</span></li><li class="L6"><span class="pun">|</span><span class="pln">     </span><span class="lit">31</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">13</span><span class="pun">|</span><span class="pln">  </span><span class="lit">2.4953516</span><span class="pun">|</span></li><li class="L7"><span class="pun">|</span><span class="pln">     </span><span class="lit">31</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">24</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.065728</span><span class="pun">|</span></li><li class="L8"><span class="pun">|</span><span class="pln">     </span><span class="lit">31</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">     </span><span class="lit">0</span><span class="pun">|</span><span class="pln"> </span><span class="lit">0.27203378</span><span class="pun">|</span></li><li class="L9"><span class="pun">|</span><span class="pln">     </span><span class="lit">85</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">28</span><span class="pun">|</span><span class="pln"> </span><span class="pun">-</span><span class="lit">4.3580985</span><span class="pun">|</span></li><li class="L0"><span class="pun">|</span><span class="pln">     </span><span class="lit">85</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">12</span><span class="pun">|</span><span class="pln"> </span><span class="lit">0.40682888</span><span class="pun">|</span></li><li class="L1"><span class="pun">|</span><span class="pln">     </span><span class="lit">85</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">13</span><span class="pun">|</span><span class="pln">   </span><span class="lit">3.660988</span><span class="pun">|</span></li><li class="L2"><span class="pun">|</span><span class="pln">     </span><span class="lit">85</span><span class="pun">|</span><span class="pln">   </span><span class="lit">2.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">20</span><span class="pun">|</span><span class="pln">  </span><span class="lit">2.8040016</span><span class="pun">|</span></li><li class="L3"><span class="pun">|</span><span class="pln">     </span><span class="lit">85</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">     </span><span class="lit">5</span><span class="pun">|</span><span class="pln">  </span><span class="lit">1.5130293</span><span class="pun">|</span></li><li class="L4"><span class="pun">|</span><span class="pln">     </span><span class="lit">85</span><span class="pun">|</span><span class="pln">   </span><span class="lit">5.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">     </span><span class="lit">8</span><span class="pun">|</span><span class="pln">  </span><span class="lit">4.2697716</span><span class="pun">|</span></li><li class="L5"><span class="pun">|</span><span class="pln">     </span><span class="lit">85</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">29</span><span class="pun">|-</span><span class="lit">0.08079797</span><span class="pun">|</span></li><li class="L6"><span class="pun">|</span><span class="pln">     </span><span class="lit">65</span><span class="pun">|</span><span class="pln">   </span><span class="lit">5.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">23</span><span class="pun">|</span><span class="pln">   </span><span class="lit">2.085921</span><span class="pun">|</span></li><li class="L7"><span class="pun">|</span><span class="pln">     </span><span class="lit">65</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">24</span><span class="pun">|</span><span class="pln"> </span><span class="lit">0.24009112</span><span class="pun">|</span></li><li class="L8"><span class="pun">|</span><span class="pln">     </span><span class="lit">53</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">23</span><span class="pun">|</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1.0775211</span><span class="pun">|</span></li><li class="L9"><span class="pun">|</span><span class="pln">     </span><span class="lit">53</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">25</span><span class="pun">|</span><span class="pln">  </span><span class="lit">0.9550235</span><span class="pun">|</span></li><li class="L0"><span class="pun">|</span><span class="pln">     </span><span class="lit">78</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">28</span><span class="pun">|-</span><span class="lit">0.26401743</span><span class="pun">|</span></li><li class="L1"><span class="pun">|</span><span class="pln">     </span><span class="lit">78</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">22</span><span class="pun">|</span><span class="pln"> </span><span class="lit">0.60926896</span><span class="pun">|</span></li><li class="L2"><span class="pun">|</span><span class="pln">     </span><span class="lit">78</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">20</span><span class="pun">|</span><span class="pln"> </span><span class="lit">0.12379208</span><span class="pun">|</span></li><li class="L3"><span class="pun">|</span><span class="pln">     </span><span class="lit">34</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">14</span><span class="pun">|</span><span class="pln"> </span><span class="pun">-</span><span class="lit">0.2330051</span><span class="pun">|</span></li><li class="L4"><span class="pun">|</span><span class="pln">     </span><span class="lit">81</span><span class="pun">|</span><span class="pln">   </span><span class="lit">3.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">26</span><span class="pun">|</span><span class="pln">   </span><span class="lit">5.684144</span><span class="pun">|</span></li><li class="L5"><span class="pun">+-------+------+-------------+------+-----------+</span></li><li class="L6"><span class="pln">only showing top </span><span class="lit">20</span><span class="pln"> rows</span></li><li class="L7"><span class="pln">&nbsp;</span></li><li class="L8"><span class="pln">&nbsp;</span></li><li class="L9"><span class="pln">&nbsp;</span></li><li class="L0"><span class="pln">predictionsImplicit</span><span class="pun">.</span><span class="pln">show</span><span class="pun">()</span></li><li class="L1"><span class="pln">&nbsp;</span></li><li class="L2"><span class="pun">+-------+------+-------------+------+-----------+</span><span class="pln">                               </span></li><li class="L3"><span class="pun">|</span><span class="pln">movieId</span><span class="pun">|</span><span class="pln">rating</span><span class="pun">|</span><span class="pln">    timestamp</span><span class="pun">|</span><span class="pln">userId</span><span class="pun">|</span><span class="pln"> prediction</span><span class="pun">|</span></li><li class="L4"><span class="pun">+-------+------+-------------+------+-----------+</span></li><li class="L5"><span class="pun">|</span><span class="pln">     </span><span class="lit">31</span><span class="pun">|</span><span class="pln">   </span><span class="lit">4.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">12</span><span class="pun">|</span><span class="lit">0.012495369</span><span class="pun">|</span></li><li class="L6"><span class="pun">|</span><span class="pln">     </span><span class="lit">31</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">13</span><span class="pun">|</span><span class="pln"> </span><span class="lit">0.29184195</span><span class="pun">|</span></li><li class="L7"><span class="pun">|</span><span class="pln">     </span><span class="lit">31</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">24</span><span class="pun">|</span><span class="lit">0.030779492</span><span class="pun">|</span></li><li class="L8"><span class="pun">|</span><span class="pln">     </span><span class="lit">31</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">     </span><span class="lit">0</span><span class="pun">|-</span><span class="lit">0.11765161</span><span class="pun">|</span></li><li class="L9"><span class="pun">|</span><span class="pln">     </span><span class="lit">85</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">28</span><span class="pun">|</span><span class="pln">  </span><span class="lit">0.7986825</span><span class="pun">|</span></li><li class="L0"><span class="pun">|</span><span class="pln">     </span><span class="lit">85</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">12</span><span class="pun">|</span><span class="pln"> </span><span class="lit">0.43071586</span><span class="pun">|</span></li><li class="L1"><span class="pun">|</span><span class="pln">     </span><span class="lit">85</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">13</span><span class="pun">|-</span><span class="lit">0.43334037</span><span class="pun">|</span></li><li class="L2"><span class="pun">|</span><span class="pln">     </span><span class="lit">85</span><span class="pun">|</span><span class="pln">   </span><span class="lit">2.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">20</span><span class="pun">|</span><span class="pln"> </span><span class="lit">0.41960382</span><span class="pun">|</span></li><li class="L3"><span class="pun">|</span><span class="pln">     </span><span class="lit">85</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">     </span><span class="lit">5</span><span class="pun">|-</span><span class="lit">0.18235317</span><span class="pun">|</span></li><li class="L4"><span class="pun">|</span><span class="pln">     </span><span class="lit">85</span><span class="pun">|</span><span class="pln">   </span><span class="lit">5.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">     </span><span class="lit">8</span><span class="pun">|</span><span class="pln"> </span><span class="lit">0.15960173</span><span class="pun">|</span></li><li class="L5"><span class="pun">|</span><span class="pln">     </span><span class="lit">85</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">29</span><span class="pun">|</span><span class="lit">0.087186486</span><span class="pun">|</span></li><li class="L6"><span class="pun">|</span><span class="pln">     </span><span class="lit">65</span><span class="pun">|</span><span class="pln">   </span><span class="lit">5.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">23</span><span class="pun">|</span><span class="pln"> </span><span class="lit">0.93609256</span><span class="pun">|</span></li><li class="L7"><span class="pun">|</span><span class="pln">     </span><span class="lit">65</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">24</span><span class="pun">|</span><span class="pln"> </span><span class="lit">0.21193008</span><span class="pun">|</span></li><li class="L8"><span class="pun">|</span><span class="pln">     </span><span class="lit">53</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">23</span><span class="pun">|</span><span class="pln"> </span><span class="lit">0.30090192</span><span class="pun">|</span></li><li class="L9"><span class="pun">|</span><span class="pln">     </span><span class="lit">53</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">25</span><span class="pun">|</span><span class="pln"> </span><span class="lit">0.07434524</span><span class="pun">|</span></li><li class="L0"><span class="pun">|</span><span class="pln">     </span><span class="lit">78</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">28</span><span class="pun">|</span><span class="pln"> </span><span class="pun">-</span><span class="lit">0.3169421</span><span class="pun">|</span></li><li class="L1"><span class="pun">|</span><span class="pln">     </span><span class="lit">78</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">22</span><span class="pun">|</span><span class="pln">  </span><span class="lit">0.4639935</span><span class="pun">|</span></li><li class="L2"><span class="pun">|</span><span class="pln">     </span><span class="lit">78</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">20</span><span class="pun">|</span><span class="pln">  </span><span class="lit">0.5240105</span><span class="pun">|</span></li><li class="L3"><span class="pun">|</span><span class="pln">     </span><span class="lit">34</span><span class="pun">|</span><span class="pln">   </span><span class="lit">1.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">14</span><span class="pun">|</span><span class="lit">0.116244696</span><span class="pun">|</span></li><li class="L4"><span class="pun">|</span><span class="pln">     </span><span class="lit">81</span><span class="pun">|</span><span class="pln">   </span><span class="lit">3.0</span><span class="pun">|</span><span class="lit">1.424380312E9</span><span class="pun">|</span><span class="pln">    </span><span class="lit">26</span><span class="pun">|</span><span class="pln">  </span><span class="lit">0.3299607</span><span class="pun">|</span></li><li class="L5"><span class="pun">+-------+------+-------------+------+-----------+</span></li><li class="L6"><span class="pln">only showing top </span><span class="lit">20</span><span class="pln"> rows</span></li><li class="L7"><span class="pln">&nbsp;</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Python</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<h2>模型评估</h2>
<p>通过计算模型的均方根误差来对模型进行评估，均方根误差越小，模型越准确：</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-python prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="pln">evaluator </span><span class="pun">=</span><span class="pln"> </span><span class="typ">RegressionEvaluator</span><span class="pun">().</span><span class="pln">setMetricName</span><span class="pun">(</span><span class="str">"rmse"</span><span class="pun">).</span><span class="pln">setLabelCol</span><span class="pun">(</span><span class="str">"rating"</span><span class="pun">).</span><span class="pln">setPredictionCol</span><span class="pun">(</span><span class="str">"prediction"</span><span class="pun">)</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Python</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>打印出两个模型的均方根误差 ：</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-python prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="kwd">print</span><span class="pun">(</span><span class="str">"Explicit:Root-mean-square error = "</span><span class="pun">+</span><span class="pln">str</span><span class="pun">(</span><span class="pln">rmseExplicit</span><span class="pun">))</span></li><li class="L1"><span class="typ">Explicit</span><span class="pun">:</span><span class="typ">Root</span><span class="pun">-</span><span class="pln">mean</span><span class="pun">-</span><span class="pln">square error </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1.9093067340213505</span></li><li class="L2"><span class="kwd">print</span><span class="pun">(</span><span class="str">"Explicit:Root-mean-square error = "</span><span class="pun">+</span><span class="pln">str</span><span class="pun">(</span><span class="pln">rmseImplicit</span><span class="pun">))</span></li><li class="L3"><span class="typ">Implicit</span><span class="pun">:</span><span class="typ">Root</span><span class="pun">-</span><span class="pln">mean</span><span class="pun">-</span><span class="pln">square error </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1.9965886603519194</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Python</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
			</div><!-- .entry-content -->

	<footer class="entry-footer">
		<div class="entry-author">
			<div class="author-title">本文作者</div>
			
		<div class="author-avatar"><img src="6.6.1Spark%202.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E5%8D%8F%E5%90%8C%E8%BF%87%E6%BB%A4%E7%AE%97%E6%B3%95(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/2.jpg" alt="阮榕城" class="avatar avatar-thumbnail wp-user-avatar wp-user-avatar-thumbnail alignnone photo"></div>
		<div class="author-info">
			<p class="author-name"><a href="http://dblab.xmu.edu.cn/blog/author/ruanrongcheng/">阮榕城</a></p>
			<p class="author-desc">磨人的小妖精！</p>
			<p class="author-contact"><a href="http://www.nekomiao.me/" target="_blank" title="个人主页" class="homepage"><i class="fa fa-home"></i>www.nekomiao.me</a><i class="fa fa-envelope"></i><span class="envelope">moc.qq@crnaur</span></p>
		</div>
			</div>
		<div class="entry-info">
			<span class="permalink"><i class="fa fa-external-link"></i> <a href="http://dblab.xmu.edu.cn/blog/1781-2/" title="Spark 2.1.0 入门：协同过滤算法(Python版)">http://dblab.xmu.edu.cn/blog/1781-2/</a></span><span class="category"><i class="fa fa-folder-open-o"></i> <a href="http://dblab.xmu.edu.cn/blog/category/big-data/" rel="category tag">大数据</a></span>		</div>
		<div class="yarpp-related yarpp-related-none">
</div>
	</footer><!-- .entry-footer -->
</article><!-- #post-## -->
			</div>
</div><!-- .row -->

	<div class="row">
		<div class="col-sm-3"></div>
		<div class="col-sm-9 site-footer">
			© 2014 <a href="http://dblab.xmu.edu.cn/">厦大数据库实验室</a>
					</div>
	</div>
</div><!-- .container -->
<link rel="stylesheet" id="yarppRelatedCss-css" href="6.6.1Spark%202.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E5%8D%8F%E5%90%8C%E8%BF%87%E6%BB%A4%E7%AE%97%E6%B3%95(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/related.css" type="text/css" media="all">
<script type="text/javascript" src="6.6.1Spark%202.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E5%8D%8F%E5%90%8C%E8%BF%87%E6%BB%A4%E7%AE%97%E6%B3%95(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/prettify.js"></script>
<script type="text/javascript" src="6.6.1Spark%202.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E5%8D%8F%E5%90%8C%E8%BF%87%E6%BB%A4%E7%AE%97%E6%B3%95(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/power.js"></script>
<script type="text/javascript" src="6.6.1Spark%202.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E5%8D%8F%E5%90%8C%E8%BF%87%E6%BB%A4%E7%AE%97%E6%B3%95(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/wp-embed.js"></script>

<div class="back-to-top" id="back-to-top" title="嗖的就上去了！"><span><i class="fa fa-chevron-up"></i></span></div></body></html>