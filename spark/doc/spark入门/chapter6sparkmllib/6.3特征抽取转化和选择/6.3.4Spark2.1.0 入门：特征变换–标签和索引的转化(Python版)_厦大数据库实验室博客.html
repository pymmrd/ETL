<!DOCTYPE html>
<html lang="zh-CN"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Spark2.1.0 入门：特征变换–标签和索引的转化(Python版)_厦大数据库实验室博客</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="renderer" content="webkit">
<link rel="dns-prefetch" href="http://cdn.staticfile.org/">
<link rel="dns-prefetch" href="http://s.w.org/">
<link rel="stylesheet" id="yarppWidgetCss-css" href="6.3.4Spark2.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E7%89%B9%E5%BE%81%E5%8F%98%E6%8D%A2%E2%80%93%E6%A0%87%E7%AD%BE%E5%92%8C%E7%B4%A2%E5%BC%95%E7%9A%84%E8%BD%AC%E5%8C%96(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/widget.css" type="text/css" media="all">
<link rel="stylesheet" id="wp-quicklatex-format-css" href="6.3.4Spark2.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E7%89%B9%E5%BE%81%E5%8F%98%E6%8D%A2%E2%80%93%E6%A0%87%E7%AD%BE%E5%92%8C%E7%B4%A2%E5%BC%95%E7%9A%84%E8%BD%AC%E5%8C%96(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/quicklatex-format.css" type="text/css" media="all">
<link rel="stylesheet" id="bootstrap-css" href="6.3.4Spark2.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E7%89%B9%E5%BE%81%E5%8F%98%E6%8D%A2%E2%80%93%E6%A0%87%E7%AD%BE%E5%92%8C%E7%B4%A2%E5%BC%95%E7%9A%84%E8%BD%AC%E5%8C%96(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/bootstrap.css" type="text/css" media="all">
<link rel="stylesheet" id="font-awesome-css" href="6.3.4Spark2.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E7%89%B9%E5%BE%81%E5%8F%98%E6%8D%A2%E2%80%93%E6%A0%87%E7%AD%BE%E5%92%8C%E7%B4%A2%E5%BC%95%E7%9A%84%E8%BD%AC%E5%8C%96(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/font-awesome.css" type="text/css" media="all">
<link rel="stylesheet" id="power-css" href="6.3.4Spark2.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E7%89%B9%E5%BE%81%E5%8F%98%E6%8D%A2%E2%80%93%E6%A0%87%E7%AD%BE%E5%92%8C%E7%B4%A2%E5%BC%95%E7%9A%84%E8%BD%AC%E5%8C%96(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/style.css" type="text/css" media="all">
<link rel="stylesheet" id="google-code-prettify-css" href="6.3.4Spark2.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E7%89%B9%E5%BE%81%E5%8F%98%E6%8D%A2%E2%80%93%E6%A0%87%E7%AD%BE%E5%92%8C%E7%B4%A2%E5%BC%95%E7%9A%84%E8%BD%AC%E5%8C%96(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/prettify.css" type="text/css" media="all">
<script type="text/javascript" async="" charset="utf-8" src="6.3.4Spark2.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E7%89%B9%E5%BE%81%E5%8F%98%E6%8D%A2%E2%80%93%E6%A0%87%E7%AD%BE%E5%92%8C%E7%B4%A2%E5%BC%95%E7%9A%84%E8%BD%AC%E5%8C%96(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/core.js"></script><script src="6.3.4Spark2.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E7%89%B9%E5%BE%81%E5%8F%98%E6%8D%A2%E2%80%93%E6%A0%87%E7%AD%BE%E5%92%8C%E7%B4%A2%E5%BC%95%E7%9A%84%E8%BD%AC%E5%8C%96(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/hm.js"></script><script src="6.3.4Spark2.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E7%89%B9%E5%BE%81%E5%8F%98%E6%8D%A2%E2%80%93%E6%A0%87%E7%AD%BE%E5%92%8C%E7%B4%A2%E5%BC%95%E7%9A%84%E8%BD%AC%E5%8C%96(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/z_stat.js"></script><script type="text/javascript" src="6.3.4Spark2.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E7%89%B9%E5%BE%81%E5%8F%98%E6%8D%A2%E2%80%93%E6%A0%87%E7%AD%BE%E5%92%8C%E7%B4%A2%E5%BC%95%E7%9A%84%E8%BD%AC%E5%8C%96(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/jquery_002.js"></script>
<script type="text/javascript" src="6.3.4Spark2.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E7%89%B9%E5%BE%81%E5%8F%98%E6%8D%A2%E2%80%93%E6%A0%87%E7%AD%BE%E5%92%8C%E7%B4%A2%E5%BC%95%E7%9A%84%E8%BD%AC%E5%8C%96(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/jquery.js"></script>
<script type="text/javascript" src="6.3.4Spark2.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E7%89%B9%E5%BE%81%E5%8F%98%E6%8D%A2%E2%80%93%E6%A0%87%E7%AD%BE%E5%92%8C%E7%B4%A2%E5%BC%95%E7%9A%84%E8%BD%AC%E5%8C%96(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/jquery-migrate.js"></script>
<script type="text/javascript" src="6.3.4Spark2.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E7%89%B9%E5%BE%81%E5%8F%98%E6%8D%A2%E2%80%93%E6%A0%87%E7%AD%BE%E5%92%8C%E7%B4%A2%E5%BC%95%E7%9A%84%E8%BD%AC%E5%8C%96(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/wp-quicklatex-frontend.js"></script>
<link rel="https://api.w.org/" href="http://dblab.xmu.edu.cn/blog/wp-json/">
<link rel="prev" title="Spark 2.1.0 入门：特征抽取–CountVectorizer(Python版)" href="http://dblab.xmu.edu.cn/blog/1769-2/">
<link rel="next" title="Spark 2.1.0 入门：特征选取–卡方选择器(Python版)" href="http://dblab.xmu.edu.cn/blog/1771-2/">
<link rel="canonical" href="http://dblab.xmu.edu.cn/blog/1770-2/">
<link rel="alternate" type="application/json+oembed" href="http://dblab.xmu.edu.cn/blog/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fdblab.xmu.edu.cn%2Fblog%2F1770-2%2F">
<!--[if lt IE 9]>
<script src="http://dblab.xmu.edu.cn/blog/wp-content/themes/power/js/html5shiv.js"></script>
<![endif]-->
</head>

<body class="post-template-default single single-post postid-1770 single-format-standard group-blog">
<div class="container site-page">

<div class="row">
	<div class="col-sm-3 site-infos">
		<h4 class="site-title">
			<a href="http://dblab.xmu.edu.cn/blog/" title="厦大数据库实验室博客" rel="home">厦大数据库实验室博客</a>
		</h4>
		<div class="site-description">总结、分享、收获<p><a href="http://dblab.xmu.edu.cn/" title="厦大数据库实验室">实验室主页</a></p></div>

		<nav class="main-navigation" role="navigation">
			<div class="menu-primary-container"><ul id="menu-primary" class="menu menu-level-1"><li id="menu-item-80" class="menu-item item-level-1"><a href="http://dblab.xmu.edu.cn/blog/">首页</a></li>
<li id="menu-item-85" class="menu-item item-level-1 current-path"><a href="http://dblab.xmu.edu.cn/blog/category/big-data/">大数据</a></li>
<li id="menu-item-676" class="menu-item item-level-1"><a href="http://dblab.xmu.edu.cn/blog/category/databases/">数据库</a></li>
<li id="menu-item-87" class="menu-item item-level-1"><a href="http://dblab.xmu.edu.cn/blog/category/data-mining/">数据挖掘</a></li>
<li id="menu-item-86" class="menu-item item-level-1"><a href="http://dblab.xmu.edu.cn/blog/category/others/">其他</a></li>
</ul></div>		</nav><!-- #site-navigation -->

		<div class="search"><form role="search" method="get" class="search-form" action="http://dblab.xmu.edu.cn/blog/">
				<label>
					<span class="screen-reader-text">搜索：</span>
					<input class="search-field" placeholder="搜索…" name="s" type="search">
				</label>
				<input class="search-submit" value="搜索" type="submit">
			</form></div>
	</div>
	<div class="col-sm-9 site-main">

					<article id="post-1770" class="post-1770 post type-post status-publish format-standard hentry category-big-data">
	<header class="entry-header">
		<h1 class="entry-title">Spark2.1.0 入门：特征变换–标签和索引的转化(Python版)</h1>

		<div class="entry-meta">
			<span class="author"><i class="fa fa-user"></i> 阮榕城</span><span class="date"><i class="fa fa-calendar"></i> <time datetime="2017-12-18T10:54:44+00:00">2017年12月18日</time></span><span class="views" id="views"><i class="fa fa-eye"></i> 1375</span>		</div><!-- .entry-meta -->
	</header><!-- .entry-header -->

	<div class="entry-content">
		<div class="bigdata-book">
			<a href="http://dblab.xmu.edu.cn/post/5899/" title="2019年1月20日寒假大数据师资培训班" target="_blank"><img src="6.3.4Spark2.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E7%89%B9%E5%BE%81%E5%8F%98%E6%8D%A2%E2%80%93%E6%A0%87%E7%AD%BE%E5%92%8C%E7%B4%A2%E5%BC%95%E7%9A%84%E8%BD%AC%E5%8C%96(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/peixunban2019-01-20.jpg" alt="2019年1月20日寒假大数据师资培训班"></a>
		</div>
		<p>【版权声明】博客内容由厦门大学数据库实验室拥有版权，未经允许，请勿转载！</p>
<p><a href="http://dblab.xmu.edu.cn/blog/1709-2/" target="_blank">返回Spark教程首页</a><br>
在机器学习处理过程中，为了方便相关算法的实现，经常需要把标签数据（一般是字符串）转化成整数索引，或是在计算结束后将整数索引还原为相应的标签。<br>
<span id="more-1770"></span><br>
Spark 
ML包中提供了几个相关的转换器，例如：StringIndexer、IndexToString、OneHotEncoder、
VectorIndexer，它们提供了十分方便的特征转换功能，这些转换器类都位于org.apache.spark.ml.feature包下。</p>
<p>值得注意的是，用于特征转换的转换器和其他的机器学习算法一样，也属于ML 
Pipeline模型的一部分，可以用来构成机器学习流水线，以StringIndexer为例，其存储着进行标签数值化过程的相关 
超参数，是一个Estimator，对其调用fit(..)方法即可生成相应的模型StringIndexerModel类，很显然，它存储了用于
DataFrame进行相关处理的 参数，是一个Transformer（其他转换器也是同一原理）<br>
下面对几个常用的转换器依次进行介绍。</p>
<h1>StringIndexer</h1>
<p>​StringIndexer转换器可以把一列类别型的特征（或标签）进行编码，使其数值化，索引的范围从0开始，该过程可以使得相应的特征索引化，使得某些无法接受类别型特征的算法可以使用，并提高诸如决策树等机器学习算法的效率。</p>
<p>索引构建的顺序为标签的频率，优先编码频率较大的标签，所以出现频率最高的标签为0号。<br>
如果输入的是数值型的，我们会把它转化成字符型，然后再对其进行编码。</p>
<p>首先，引入必要的包，并创建一个简单的DataFrame，它只包含一个id列和一个标签列category：</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-python prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="kwd">from</span><span class="pln"> pyspark</span><span class="pun">.</span><span class="pln">ml</span><span class="pun">.</span><span class="pln">feature </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">StringIndexer</span></li><li class="L1"><span class="pln">&nbsp;</span></li><li class="L2"><span class="pln">df </span><span class="pun">=</span><span class="pln"> spark</span><span class="pun">.</span><span class="pln">createDataFrame</span><span class="pun">(</span></li><li class="L3"><span class="pln">    </span><span class="pun">[(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="str">"a"</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="str">"b"</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="str">"c"</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="str">"a"</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="str">"a"</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="str">"c"</span><span class="pun">)],</span></li><li class="L4"><span class="pln">    </span><span class="pun">[</span><span class="str">"id"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"category"</span><span class="pun">])</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Python</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>随后，我们创建一个StringIndexer对象，设定输入输出列名，其余参数采用默认值，并对这个DataFrame进行训练，产生StringIndexerModel对象：</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-python prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="pln">indexer </span><span class="pun">=</span><span class="pln"> </span><span class="typ">StringIndexer</span><span class="pun">(</span><span class="pln">inputCol</span><span class="pun">=</span><span class="str">"category"</span><span class="pun">,</span><span class="pln"> outputCol</span><span class="pun">=</span><span class="str">"categoryIndex"</span><span class="pun">)</span></li><li class="L1"><span class="pln">model </span><span class="pun">=</span><span class="pln"> indexer</span><span class="pun">.</span><span class="pln">fit</span><span class="pun">(</span><span class="pln">df</span><span class="pun">)</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Python</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>随后即可利用该对象对DataFrame进行转换操作，可以看到，StringIndexerModel依次按照出现频率的高低，把字符标签进行了排序，即出现最多的“a”被编号成0，“c”为1，出现最少的“b”为0。</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-python prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="pln">indexed </span><span class="pun">=</span><span class="pln"> model</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">(</span><span class="pln">df</span><span class="pun">)</span></li><li class="L1"><span class="pln">indexed</span><span class="pun">.</span><span class="pln">show</span><span class="pun">()</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="pun">+---+--------+-------------+</span></li><li class="L4"><span class="pun">|</span><span class="pln"> id</span><span class="pun">|</span><span class="pln">category</span><span class="pun">|</span><span class="pln">categoryIndex</span><span class="pun">|</span></li><li class="L5"><span class="pun">+---+--------+-------------+</span></li><li class="L6"><span class="pun">|</span><span class="pln">  </span><span class="lit">0</span><span class="pun">|</span><span class="pln">       a</span><span class="pun">|</span><span class="pln">          </span><span class="lit">0.0</span><span class="pun">|</span></li><li class="L7"><span class="pun">|</span><span class="pln">  </span><span class="lit">1</span><span class="pun">|</span><span class="pln">       b</span><span class="pun">|</span><span class="pln">          </span><span class="lit">2.0</span><span class="pun">|</span></li><li class="L8"><span class="pun">|</span><span class="pln">  </span><span class="lit">2</span><span class="pun">|</span><span class="pln">       c</span><span class="pun">|</span><span class="pln">          </span><span class="lit">1.0</span><span class="pun">|</span></li><li class="L9"><span class="pun">|</span><span class="pln">  </span><span class="lit">3</span><span class="pun">|</span><span class="pln">       a</span><span class="pun">|</span><span class="pln">          </span><span class="lit">0.0</span><span class="pun">|</span></li><li class="L0"><span class="pun">|</span><span class="pln">  </span><span class="lit">4</span><span class="pun">|</span><span class="pln">       a</span><span class="pun">|</span><span class="pln">          </span><span class="lit">0.0</span><span class="pun">|</span></li><li class="L1"><span class="pun">|</span><span class="pln">  </span><span class="lit">5</span><span class="pun">|</span><span class="pln">       c</span><span class="pun">|</span><span class="pln">          </span><span class="lit">1.0</span><span class="pun">|</span></li><li class="L2"><span class="pun">+---+--------+-------------+</span></li><li class="L3"><span class="pln">&nbsp;</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Python</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<h1>IndexToString</h1>
<p>与StringIndexer相对应，IndexToString的作用是把标签索引的一列重新映射回原有的字符型标签。</p>
<p>其主要使用场景一般都是和StringIndexer配合，先用StringIndexer将标签转化成标签索引，进行模型训练，然后在预测标签的时候再把标签索引转化成原有的字符标签。当然，你也可以另外定义其他的标签。</p>
<p>首先，和StringIndexer的实验相同，我们用StringIndexer读取数据集中的“category”列，把字符型标签转化成标签索引，然后输出到“categoryIndex”列上，构建出新的DataFrame。</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-python prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="kwd">from</span><span class="pln"> pyspark</span><span class="pun">.</span><span class="pln">ml</span><span class="pun">.</span><span class="pln">feature </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">IndexToString</span><span class="pun">,</span><span class="pln"> </span><span class="typ">StringIndexer</span></li><li class="L1"><span class="pln">&nbsp;</span></li><li class="L2"><span class="pln">df </span><span class="pun">=</span><span class="pln"> spark</span><span class="pun">.</span><span class="pln">createDataFrame</span><span class="pun">(</span></li><li class="L3"><span class="pln">    </span><span class="pun">[(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="str">"a"</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="str">"b"</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="str">"c"</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="str">"a"</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="str">"a"</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="str">"c"</span><span class="pun">)],</span></li><li class="L4"><span class="pln">    </span><span class="pun">[</span><span class="str">"id"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"category"</span><span class="pun">])</span></li><li class="L5"><span class="pln">&nbsp;</span></li><li class="L6"><span class="pln">indexer </span><span class="pun">=</span><span class="pln"> </span><span class="typ">StringIndexer</span><span class="pun">(</span><span class="pln">inputCol</span><span class="pun">=</span><span class="str">"category"</span><span class="pun">,</span><span class="pln"> outputCol</span><span class="pun">=</span><span class="str">"categoryIndex"</span><span class="pun">)</span></li><li class="L7"><span class="pln">model </span><span class="pun">=</span><span class="pln"> indexer</span><span class="pun">.</span><span class="pln">fit</span><span class="pun">(</span><span class="pln">df</span><span class="pun">)</span></li><li class="L8"><span class="pln">indexed </span><span class="pun">=</span><span class="pln"> model</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">(</span><span class="pln">df</span><span class="pun">)</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Python</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>随后，创建IndexToString对象，读取“categoryIndex”上的标签索引，获得原有数据集的字符型标签，然后再输出到
“originalCategory”列上。最后，通过输出“originalCategory”列，可以看到数据集中原有的字符标签。</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-python prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="pln">converter </span><span class="pun">=</span><span class="pln"> </span><span class="typ">IndexToString</span><span class="pun">(</span><span class="pln">inputCol</span><span class="pun">=</span><span class="str">"categoryIndex"</span><span class="pun">,</span><span class="pln"> outputCol</span><span class="pun">=</span><span class="str">"originalCategory"</span><span class="pun">)</span></li><li class="L1"><span class="pln">converted </span><span class="pun">=</span><span class="pln"> converter</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">(</span><span class="pln">indexed</span><span class="pun">)</span></li><li class="L2"><span class="pln">converted</span><span class="pun">.</span><span class="pln">select</span><span class="pun">(</span><span class="str">"id"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"categoryIndex"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"originalCategory"</span><span class="pun">).</span><span class="pln">show</span><span class="pun">()</span></li><li class="L3"><span class="pln">&nbsp;</span></li><li class="L4"><span class="pun">+---+-------------+----------------+</span></li><li class="L5"><span class="pun">|</span><span class="pln"> id</span><span class="pun">|</span><span class="pln">categoryIndex</span><span class="pun">|</span><span class="pln">originalCategory</span><span class="pun">|</span></li><li class="L6"><span class="pun">+---+-------------+----------------+</span></li><li class="L7"><span class="pun">|</span><span class="pln">  </span><span class="lit">0</span><span class="pun">|</span><span class="pln">          </span><span class="lit">0.0</span><span class="pun">|</span><span class="pln">               a</span><span class="pun">|</span></li><li class="L8"><span class="pun">|</span><span class="pln">  </span><span class="lit">1</span><span class="pun">|</span><span class="pln">          </span><span class="lit">2.0</span><span class="pun">|</span><span class="pln">               b</span><span class="pun">|</span></li><li class="L9"><span class="pun">|</span><span class="pln">  </span><span class="lit">2</span><span class="pun">|</span><span class="pln">          </span><span class="lit">1.0</span><span class="pun">|</span><span class="pln">               c</span><span class="pun">|</span></li><li class="L0"><span class="pun">|</span><span class="pln">  </span><span class="lit">3</span><span class="pun">|</span><span class="pln">          </span><span class="lit">0.0</span><span class="pun">|</span><span class="pln">               a</span><span class="pun">|</span></li><li class="L1"><span class="pun">|</span><span class="pln">  </span><span class="lit">4</span><span class="pun">|</span><span class="pln">          </span><span class="lit">0.0</span><span class="pun">|</span><span class="pln">               a</span><span class="pun">|</span></li><li class="L2"><span class="pun">|</span><span class="pln">  </span><span class="lit">5</span><span class="pun">|</span><span class="pln">          </span><span class="lit">1.0</span><span class="pun">|</span><span class="pln">               c</span><span class="pun">|</span></li><li class="L3"><span class="pun">+---+-------------+----------------+</span></li><li class="L4"><span class="pln">&nbsp;</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Python</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<h1>OneHotEncoder</h1>
<p>​独热编码（One-Hot Encoding） 是指把一列类别性特征（或称名词性特征，nominal/categorical 
features）映射成一系列的二元连续特征的过程，原有的类别性特征有几种可能取值，这一特征就会被映射成几个二元连续特征，每一个特征代表一种取
值，若该样本表现出该特征，则取1，否则取0。</p>
<p>One-Hot编码适合一些期望类别特征为连续特征的算法，比如说逻辑斯蒂回归等。</p>
<p>首先创建一个DataFrame，其包含一列类别性特征，需要注意的是，在使用OneHotEncoder进行转换前，DataFrame需要先使用StringIndexer将原始标签数值化：</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-python prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="kwd">from</span><span class="pln"> pyspark</span><span class="pun">.</span><span class="pln">ml</span><span class="pun">.</span><span class="pln">feature </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">OneHotEncoder</span><span class="pun">,</span><span class="pln"> </span><span class="typ">StringIndexer</span></li><li class="L1"><span class="pln">&nbsp;</span></li><li class="L2"><span class="pln">df </span><span class="pun">=</span><span class="pln"> spark</span><span class="pun">.</span><span class="pln">createDataFrame</span><span class="pun">([</span></li><li class="L3"><span class="pln">    </span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="str">"a"</span><span class="pun">),</span></li><li class="L4"><span class="pln">    </span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="str">"b"</span><span class="pun">),</span></li><li class="L5"><span class="pln">    </span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="str">"c"</span><span class="pun">),</span></li><li class="L6"><span class="pln">    </span><span class="pun">(</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="str">"a"</span><span class="pun">),</span></li><li class="L7"><span class="pln">    </span><span class="pun">(</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="str">"a"</span><span class="pun">),</span></li><li class="L8"><span class="pln">    </span><span class="pun">(</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="str">"c"</span><span class="pun">)</span></li><li class="L9"><span class="pun">],</span><span class="pln"> </span><span class="pun">[</span><span class="str">"id"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"category"</span><span class="pun">])</span></li><li class="L0"><span class="pln">&nbsp;</span></li><li class="L1"><span class="pln">stringIndexer </span><span class="pun">=</span><span class="pln"> </span><span class="typ">StringIndexer</span><span class="pun">(</span><span class="pln">inputCol</span><span class="pun">=</span><span class="str">"category"</span><span class="pun">,</span><span class="pln"> outputCol</span><span class="pun">=</span><span class="str">"categoryIndex"</span><span class="pun">)</span></li><li class="L2"><span class="pln">model </span><span class="pun">=</span><span class="pln"> stringIndexer</span><span class="pun">.</span><span class="pln">fit</span><span class="pun">(</span><span class="pln">df</span><span class="pun">)</span></li><li class="L3"><span class="pln">indexed </span><span class="pun">=</span><span class="pln"> model</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">(</span><span class="pln">df</span><span class="pun">)</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Python</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>随后，我们创建OneHotEncoder对象对处理后的DataFrame进行编码，可以看见，编码后的二进制特征呈稀疏向量形式，与
StringIndexer编码的顺序相同，需注意的是最后一个Category（”b”）被编码为全0向量，若希望”b”也占有一个二进制特征，则可在
创建OneHotEncoder时指定setDropLast(false)。</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-python prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="pln">encoder </span><span class="pun">=</span><span class="pln"> </span><span class="typ">OneHotEncoder</span><span class="pun">(</span><span class="pln">inputCol</span><span class="pun">=</span><span class="str">"categoryIndex"</span><span class="pun">,</span><span class="pln"> outputCol</span><span class="pun">=</span><span class="str">"categoryVec"</span><span class="pun">)</span></li><li class="L1"><span class="pln">encoded </span><span class="pun">=</span><span class="pln"> encoder</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">(</span><span class="pln">indexed</span><span class="pun">)</span></li><li class="L2"><span class="pln">encoded</span><span class="pun">.</span><span class="pln">show</span><span class="pun">()</span></li><li class="L3"><span class="pln">&nbsp;</span></li><li class="L4"><span class="pun">+---+--------+-------------+-------------+</span></li><li class="L5"><span class="pun">|</span><span class="pln"> id</span><span class="pun">|</span><span class="pln">category</span><span class="pun">|</span><span class="pln">categoryIndex</span><span class="pun">|</span><span class="pln">  categoryVec</span><span class="pun">|</span></li><li class="L6"><span class="pun">+---+--------+-------------+-------------+</span></li><li class="L7"><span class="pun">|</span><span class="pln">  </span><span class="lit">0</span><span class="pun">|</span><span class="pln">       a</span><span class="pun">|</span><span class="pln">          </span><span class="lit">0.0</span><span class="pun">|(</span><span class="lit">2</span><span class="pun">,[</span><span class="lit">0</span><span class="pun">],[</span><span class="lit">1.0</span><span class="pun">])|</span></li><li class="L8"><span class="pun">|</span><span class="pln">  </span><span class="lit">1</span><span class="pun">|</span><span class="pln">       b</span><span class="pun">|</span><span class="pln">          </span><span class="lit">2.0</span><span class="pun">|</span><span class="pln">    </span><span class="pun">(</span><span class="lit">2</span><span class="pun">,[],[])|</span></li><li class="L9"><span class="pun">|</span><span class="pln">  </span><span class="lit">2</span><span class="pun">|</span><span class="pln">       c</span><span class="pun">|</span><span class="pln">          </span><span class="lit">1.0</span><span class="pun">|(</span><span class="lit">2</span><span class="pun">,[</span><span class="lit">1</span><span class="pun">],[</span><span class="lit">1.0</span><span class="pun">])|</span></li><li class="L0"><span class="pun">|</span><span class="pln">  </span><span class="lit">3</span><span class="pun">|</span><span class="pln">       a</span><span class="pun">|</span><span class="pln">          </span><span class="lit">0.0</span><span class="pun">|(</span><span class="lit">2</span><span class="pun">,[</span><span class="lit">0</span><span class="pun">],[</span><span class="lit">1.0</span><span class="pun">])|</span></li><li class="L1"><span class="pun">|</span><span class="pln">  </span><span class="lit">4</span><span class="pun">|</span><span class="pln">       a</span><span class="pun">|</span><span class="pln">          </span><span class="lit">0.0</span><span class="pun">|(</span><span class="lit">2</span><span class="pun">,[</span><span class="lit">0</span><span class="pun">],[</span><span class="lit">1.0</span><span class="pun">])|</span></li><li class="L2"><span class="pun">|</span><span class="pln">  </span><span class="lit">5</span><span class="pun">|</span><span class="pln">       c</span><span class="pun">|</span><span class="pln">          </span><span class="lit">1.0</span><span class="pun">|(</span><span class="lit">2</span><span class="pun">,[</span><span class="lit">1</span><span class="pun">],[</span><span class="lit">1.0</span><span class="pun">])|</span></li><li class="L3"><span class="pun">+---+--------+-------------+-------------+</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Python</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<h1>VectorIndexer</h1>
<p>之前介绍的StringIndexer是针对单个类别型特征进行转换，倘若所有特征都已经被组织在一个向量中，又想对其中某些单个分量进行处理时，Spark ML提供了VectorIndexer类来解决向量数据集中的类别性特征转换。</p>
<p>通过为其提供maxCategories超参数，它可以自动识别哪些特征是类别型的，并且将原始值转换为类别索引。它基于不同特征值的数量来识别哪些特征需要被类别化，那些取值可能性最多不超过maxCategories的特征需要会被认为是类别型的。</p>
<p>在下面的例子中，我们读入一个数据集，然后使用VectorIndexer训练出模型，来决定哪些特征需要被作为类别特征，将类别特征转换为索引，这里设置maxCategories为10，即只有种类小10的特征才被认为是类别型特征，否则被认为是连续型特征：</p>
<pre><code>from pyspark.ml.feature import VectorIndexer
data = spark.read.format('libsvm').load('file:///usr/local/spark/data/mllib/sample_libsvm_data.txt')
indexer = VectorIndexer(inputCol="features", outputCol="indexed", maxCategories=10)
indexerModel = indexer.fit(data)
categoricalFeatures = indexerModel.categoryMaps
indexedData = indexerModel.transform(data)
indexedData.show()


+-----+--------------------+--------------------+
|label|            features|             indexed|
+-----+--------------------+--------------------+
|  0.0|(692,[127,128,129...|(692,[127,128,129...|
|  1.0|(692,[158,159,160...|(692,[158,159,160...|
|  1.0|(692,[124,125,126...|(692,[124,125,126...|
|  1.0|(692,[152,153,154...|(692,[152,153,154...|
|  1.0|(692,[151,152,153...|(692,[151,152,153...|
|  0.0|(692,[129,130,131...|(692,[129,130,131...|
|  1.0|(692,[158,159,160...|(692,[158,159,160...|
|  1.0|(692,[99,100,101,...|(692,[99,100,101,...|
|  0.0|(692,[154,155,156...|(692,[154,155,156...|
|  0.0|(692,[127,128,129...|(692,[127,128,129...|
|  1.0|(692,[154,155,156...|(692,[154,155,156...|
|  0.0|(692,[153,154,155...|(692,[153,154,155...|
|  0.0|(692,[151,152,153...|(692,[151,152,153...|
|  1.0|(692,[129,130,131...|(692,[129,130,131...|
|  0.0|(692,[154,155,156...|(692,[154,155,156...|
|  1.0|(692,[150,151,152...|(692,[150,151,152...|
|  0.0|(692,[124,125,126...|(692,[124,125,126...|
|  0.0|(692,[152,153,154...|(692,[152,153,154...|
|  1.0|(692,[97,98,99,12...|(692,[97,98,99,12...|
|  1.0|(692,[124,125,126...|(692,[124,125,126...|
+-----+--------------------+--------------------+

</code></pre>
			</div><!-- .entry-content -->

	<footer class="entry-footer">
		<div class="entry-author">
			<div class="author-title">本文作者</div>
			
		<div class="author-avatar"><img src="6.3.4Spark2.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E7%89%B9%E5%BE%81%E5%8F%98%E6%8D%A2%E2%80%93%E6%A0%87%E7%AD%BE%E5%92%8C%E7%B4%A2%E5%BC%95%E7%9A%84%E8%BD%AC%E5%8C%96(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/2.jpg" alt="阮榕城" class="avatar avatar-thumbnail wp-user-avatar wp-user-avatar-thumbnail alignnone photo"></div>
		<div class="author-info">
			<p class="author-name"><a href="http://dblab.xmu.edu.cn/blog/author/ruanrongcheng/">阮榕城</a></p>
			<p class="author-desc">磨人的小妖精！</p>
			<p class="author-contact"><a href="http://www.nekomiao.me/" target="_blank" title="个人主页" class="homepage"><i class="fa fa-home"></i>www.nekomiao.me</a><i class="fa fa-envelope"></i><span class="envelope">moc.qq@crnaur</span></p>
		</div>
			</div>
		<div class="entry-info">
			<span class="permalink"><i class="fa fa-external-link"></i> <a href="http://dblab.xmu.edu.cn/blog/1770-2/" title="Spark2.1.0 入门：特征变换–标签和索引的转化(Python版)">http://dblab.xmu.edu.cn/blog/1770-2/</a></span><span class="category"><i class="fa fa-folder-open-o"></i> <a href="http://dblab.xmu.edu.cn/blog/category/big-data/" rel="category tag">大数据</a></span>		</div>
		<div class="yarpp-related yarpp-related-none">
</div>
	</footer><!-- .entry-footer -->
</article><!-- #post-## -->
			</div>
</div><!-- .row -->

	<div class="row">
		<div class="col-sm-3"></div>
		<div class="col-sm-9 site-footer">
			© 2014 <a href="http://dblab.xmu.edu.cn/">厦大数据库实验室</a>
					</div>
	</div>
</div><!-- .container -->
<link rel="stylesheet" id="yarppRelatedCss-css" href="6.3.4Spark2.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E7%89%B9%E5%BE%81%E5%8F%98%E6%8D%A2%E2%80%93%E6%A0%87%E7%AD%BE%E5%92%8C%E7%B4%A2%E5%BC%95%E7%9A%84%E8%BD%AC%E5%8C%96(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/related.css" type="text/css" media="all">
<script type="text/javascript" src="6.3.4Spark2.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E7%89%B9%E5%BE%81%E5%8F%98%E6%8D%A2%E2%80%93%E6%A0%87%E7%AD%BE%E5%92%8C%E7%B4%A2%E5%BC%95%E7%9A%84%E8%BD%AC%E5%8C%96(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/prettify.js"></script>
<script type="text/javascript" src="6.3.4Spark2.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E7%89%B9%E5%BE%81%E5%8F%98%E6%8D%A2%E2%80%93%E6%A0%87%E7%AD%BE%E5%92%8C%E7%B4%A2%E5%BC%95%E7%9A%84%E8%BD%AC%E5%8C%96(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/power.js"></script>
<script type="text/javascript" src="6.3.4Spark2.1.0%20%E5%85%A5%E9%97%A8%EF%BC%9A%E7%89%B9%E5%BE%81%E5%8F%98%E6%8D%A2%E2%80%93%E6%A0%87%E7%AD%BE%E5%92%8C%E7%B4%A2%E5%BC%95%E7%9A%84%E8%BD%AC%E5%8C%96(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/wp-embed.js"></script>

<div class="back-to-top" id="back-to-top" title="嗖的就上去了！"><span><i class="fa fa-chevron-up"></i></span></div></body></html>