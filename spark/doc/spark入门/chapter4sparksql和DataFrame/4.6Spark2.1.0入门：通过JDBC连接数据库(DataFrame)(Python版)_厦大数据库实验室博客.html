<!DOCTYPE html>
<html lang="zh-CN"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Spark2.1.0入门：通过JDBC连接数据库(DataFrame)(Python版)_厦大数据库实验室博客</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="renderer" content="webkit">
<link rel="dns-prefetch" href="http://cdn.staticfile.org/">
<link rel="dns-prefetch" href="http://s.w.org/">
<link rel="stylesheet" id="yarppWidgetCss-css" href="4.6Spark2.1.0%E5%85%A5%E9%97%A8%EF%BC%9A%E9%80%9A%E8%BF%87JDBC%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93(DataFrame)(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/widget.css" type="text/css" media="all">
<link rel="stylesheet" id="wp-quicklatex-format-css" href="4.6Spark2.1.0%E5%85%A5%E9%97%A8%EF%BC%9A%E9%80%9A%E8%BF%87JDBC%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93(DataFrame)(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/quicklatex-format.css" type="text/css" media="all">
<link rel="stylesheet" id="bootstrap-css" href="4.6Spark2.1.0%E5%85%A5%E9%97%A8%EF%BC%9A%E9%80%9A%E8%BF%87JDBC%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93(DataFrame)(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/bootstrap.css" type="text/css" media="all">
<link rel="stylesheet" id="font-awesome-css" href="4.6Spark2.1.0%E5%85%A5%E9%97%A8%EF%BC%9A%E9%80%9A%E8%BF%87JDBC%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93(DataFrame)(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/font-awesome.css" type="text/css" media="all">
<link rel="stylesheet" id="power-css" href="4.6Spark2.1.0%E5%85%A5%E9%97%A8%EF%BC%9A%E9%80%9A%E8%BF%87JDBC%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93(DataFrame)(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/style.css" type="text/css" media="all">
<link rel="stylesheet" id="google-code-prettify-css" href="4.6Spark2.1.0%E5%85%A5%E9%97%A8%EF%BC%9A%E9%80%9A%E8%BF%87JDBC%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93(DataFrame)(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/prettify.css" type="text/css" media="all">
<script type="text/javascript" async="" charset="utf-8" src="4.6Spark2.1.0%E5%85%A5%E9%97%A8%EF%BC%9A%E9%80%9A%E8%BF%87JDBC%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93(DataFrame)(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/core.js"></script><script src="4.6Spark2.1.0%E5%85%A5%E9%97%A8%EF%BC%9A%E9%80%9A%E8%BF%87JDBC%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93(DataFrame)(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/hm.js"></script><script src="4.6Spark2.1.0%E5%85%A5%E9%97%A8%EF%BC%9A%E9%80%9A%E8%BF%87JDBC%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93(DataFrame)(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/z_stat.js"></script><script type="text/javascript" src="4.6Spark2.1.0%E5%85%A5%E9%97%A8%EF%BC%9A%E9%80%9A%E8%BF%87JDBC%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93(DataFrame)(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/jquery_002.js"></script>
<script type="text/javascript" src="4.6Spark2.1.0%E5%85%A5%E9%97%A8%EF%BC%9A%E9%80%9A%E8%BF%87JDBC%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93(DataFrame)(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/jquery.js"></script>
<script type="text/javascript" src="4.6Spark2.1.0%E5%85%A5%E9%97%A8%EF%BC%9A%E9%80%9A%E8%BF%87JDBC%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93(DataFrame)(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/jquery-migrate.js"></script>
<script type="text/javascript" src="4.6Spark2.1.0%E5%85%A5%E9%97%A8%EF%BC%9A%E9%80%9A%E8%BF%87JDBC%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93(DataFrame)(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/wp-quicklatex-frontend.js"></script>
<link rel="https://api.w.org/" href="http://dblab.xmu.edu.cn/blog/wp-json/">
<link rel="prev" title="Spark2.1.0+入门：读写Parquet(DataFrame)(Python版)" href="http://dblab.xmu.edu.cn/blog/1723-2/">
<link rel="next" title="Python：元组" href="http://dblab.xmu.edu.cn/blog/1725-2/">
<link rel="canonical" href="http://dblab.xmu.edu.cn/blog/1724-2/">
<link rel="alternate" type="application/json+oembed" href="http://dblab.xmu.edu.cn/blog/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fdblab.xmu.edu.cn%2Fblog%2F1724-2%2F">
<!--[if lt IE 9]>
<script src="http://dblab.xmu.edu.cn/blog/wp-content/themes/power/js/html5shiv.js"></script>
<![endif]-->
</head>

<body class="post-template-default single single-post postid-1724 single-format-standard group-blog">
<div class="container site-page">

<div class="row">
	<div class="col-sm-3 site-infos">
		<h4 class="site-title">
			<a href="http://dblab.xmu.edu.cn/blog/" title="厦大数据库实验室博客" rel="home">厦大数据库实验室博客</a>
		</h4>
		<div class="site-description">总结、分享、收获<p><a href="http://dblab.xmu.edu.cn/" title="厦大数据库实验室">实验室主页</a></p></div>

		<nav class="main-navigation" role="navigation">
			<div class="menu-primary-container"><ul id="menu-primary" class="menu menu-level-1"><li id="menu-item-80" class="menu-item item-level-1"><a href="http://dblab.xmu.edu.cn/blog/">首页</a></li>
<li id="menu-item-85" class="menu-item item-level-1 current-path"><a href="http://dblab.xmu.edu.cn/blog/category/big-data/">大数据</a></li>
<li id="menu-item-676" class="menu-item item-level-1"><a href="http://dblab.xmu.edu.cn/blog/category/databases/">数据库</a></li>
<li id="menu-item-87" class="menu-item item-level-1"><a href="http://dblab.xmu.edu.cn/blog/category/data-mining/">数据挖掘</a></li>
<li id="menu-item-86" class="menu-item item-level-1"><a href="http://dblab.xmu.edu.cn/blog/category/others/">其他</a></li>
</ul></div>		</nav><!-- #site-navigation -->

		<div class="search"><form role="search" method="get" class="search-form" action="http://dblab.xmu.edu.cn/blog/">
				<label>
					<span class="screen-reader-text">搜索：</span>
					<input class="search-field" placeholder="搜索…" name="s" type="search">
				</label>
				<input class="search-submit" value="搜索" type="submit">
			</form></div>
	</div>
	<div class="col-sm-9 site-main">

					<article id="post-1724" class="post-1724 post type-post status-publish format-standard hentry category-big-data">
	<header class="entry-header">
		<h1 class="entry-title">Spark2.1.0入门：通过JDBC连接数据库(DataFrame)(Python版)</h1>

		<div class="entry-meta">
			<span class="author"><i class="fa fa-user"></i> 阮榕城</span><span class="date"><i class="fa fa-calendar"></i> <time datetime="2017-12-07T19:06:38+00:00">2017年12月7日</time> <span class="updated">(updated: <time class="updated" datetime="2017-12-13T16:29:20+00:00">2017年12月13日</time>)</span></span><span class="views" id="views"><i class="fa fa-eye"></i> 4786</span>		</div><!-- .entry-meta -->
	</header><!-- .entry-header -->

	<div class="entry-content">
		<div class="bigdata-book">
			<a href="http://dblab.xmu.edu.cn/post/5899/" title="2019年1月20日寒假大数据师资培训班" target="_blank"><img src="4.6Spark2.1.0%E5%85%A5%E9%97%A8%EF%BC%9A%E9%80%9A%E8%BF%87JDBC%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93(DataFrame)(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/peixunban2019-01-20.jpg" alt="2019年1月20日寒假大数据师资培训班"></a>
		</div>
		<p>【版权声明】博客内容由厦门大学数据库实验室拥有版权，未经允许，请勿转载！<br>
<a href="http://dblab.xmu.edu.cn/blog/1709-2/" target="_blank">返回Spark教程首页</a></p>
<p>这里以关系数据库MySQL为例。首先，请参考厦门大学数据库实验室博客教程（Ubuntu安装MySQL），在Linux系统中安装好MySQL
数据库。这里假设你已经成功安装了MySQL数据库。下面我们要新建一个测试Spark程序的数据库，数据库名称是“spark”，表的名称是
“student”。<br>
<span id="more-1724"></span><br>
请执行下面命令在Linux中启动MySQL数据库，并完成数据库和表的创建，以及样例数据的录入：</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-bash prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="pln">service mysql start</span></li><li class="L1"><span class="pln">mysql -u root -p</span></li><li class="L2"><span class="pln">//屏幕会提示你输入密码</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Shell 命令</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>输入密码后，你就可以进入“mysql&gt;”命令提示符状态，然后就可以输入下面的SQL语句完成数据库和表的创建：</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-mysql prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="pln">mysql</span><span class="pun">&gt;</span><span class="pln"> create database spark</span><span class="pun">;</span></li><li class="L1"><span class="pln">mysql</span><span class="pun">&gt;</span><span class="pln"> </span><span class="kwd">use</span><span class="pln"> spark</span><span class="pun">;</span></li><li class="L2"><span class="pln">mysql</span><span class="pun">&gt;</span><span class="pln"> create table student </span><span class="pun">(</span><span class="pln">id </span><span class="kwd">int</span><span class="pun">(</span><span class="lit">4</span><span class="pun">),</span><span class="pln"> name </span><span class="kwd">char</span><span class="pun">(</span><span class="lit">20</span><span class="pun">),</span><span class="pln"> gender </span><span class="kwd">char</span><span class="pun">(</span><span class="lit">4</span><span class="pun">),</span><span class="pln"> age </span><span class="kwd">int</span><span class="pun">(</span><span class="lit">4</span><span class="pun">));</span></li><li class="L3"><span class="pln">mysql</span><span class="pun">&gt;</span><span class="pln"> alter table student change id id </span><span class="kwd">int</span><span class="pln"> auto_increment primary key</span><span class="pun">;</span></li><li class="L4"><span class="pln">mysql</span><span class="pun">&gt;</span><span class="pln"> insert </span><span class="kwd">into</span><span class="pln"> student values</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="str">'Xueqian'</span><span class="pun">,</span><span class="str">'F'</span><span class="pun">,</span><span class="lit">23</span><span class="pun">);</span></li><li class="L5"><span class="pln">mysql</span><span class="pun">&gt;</span><span class="pln"> insert </span><span class="kwd">into</span><span class="pln"> student values</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="str">'Weiliang'</span><span class="pun">,</span><span class="str">'M'</span><span class="pun">,</span><span class="lit">24</span><span class="pun">);</span></li><li class="L6"><span class="pln">mysql</span><span class="pun">&gt;</span><span class="pln"> </span><span class="kwd">select</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="kwd">from</span><span class="pln"> student</span><span class="pun">;</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">mysql</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>上面已经创建好了我们所需要的MySQL数据库和表，下面我们编写Spark应用程序连接MySQL数据库并且读写数据。</p>
<p>Spark支持通过JDBC方式连接到其他数据库获取数据生成DataFrame。</p>
<p>首先，请进入Linux系统（本教程统一使用hadoop用户名登录），打开火狐（FireFox）浏览器，下载一个MySQL的JDBC驱动（<a href="http://dev.mysql.com/downloads/connector/j/" target="_blank">下载</a>）。在火狐浏览器中下载时，一般默认保存在hadoop用户的当前工作目录的“下载”目录下，所以，可以打开一个终端界面，输入下面命令查看：</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-bash prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="kwd">cd </span><span class="pln">~</span></li><li class="L1"><span class="kwd">cd </span><span class="pln">下载</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Shell 命令</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>就可以看到刚才下载到的MySQL的JDBC驱动程序，文件名称为mysql-connector-java-5.1.40.tar.gz（你下载的版本可能和这个不同）。现在，使用下面命令，把该驱动程序拷贝到spark的安装目录下：</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-bash prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="kwd">sudo tar </span><span class="pln">-zxf ~/下载/mysql-connector-java-5.1.40.tar.gz -C /usr/local/spark/jars</span></li><li class="L1"><span class="kwd">cd </span><span class="pln">/usr/local/spark/jars</span></li><li class="L2"><span class="pln">ls</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Shell 命令</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>这时就可以在/usr/local/spark/jars目录下看到这个驱动程序文件所在的文件夹mysql-connector-java-
5.1.40，进入这个文件夹，就可以看到驱动程序文件mysql-connector-java-5.1.40-bin.jar。<br>
请输入下面命令启动已经安装在Linux系统中的mysql数据库（如果前面已经启动了MySQL数据库，这里就不用重复启动了）。</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-bash prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="pln">service mysql start</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Shell 命令</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>下面，我们要启动一个pyspark，而且启动的时候，要附加一些参数。启动pyspark时，必须指定mysql连接驱动jar包。</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-bash prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="kwd">cd </span><span class="pln">/usr/local/spark</span></li><li class="L1"><span class="pln">./bin/pyspark \</span></li><li class="L2"><span class="pln">--jars /usr/local/spark/jars/mysql-connector-java-5.1.40/mysql-connector-java-5.1.40-bin.jar \</span></li><li class="L3"><span class="pln">--driver-class-path /usr/local/spark/jars/mysql-connector-java-5.1.40/mysql-connector-java-5.1.40-bin.jar</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Shell 命令</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>上面的命令行中，在一行的末尾加入斜杠\，是为了告诉spark-shell，命令还没有结束。</p>
<p>启动进入pyspark以后，可以执行以下命令连接数据库，读取数据，并显示：</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-python prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> jdbcDF </span><span class="pun">=</span><span class="pln"> spark</span><span class="pun">.</span><span class="pln">read</span><span class="pun">.</span><span class="pln">format</span><span class="pun">(</span><span class="str">"jdbc"</span><span class="pun">).</span><span class="pln">option</span><span class="pun">(</span><span class="str">"url"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"jdbc:mysql://localhost:3306/spark"</span><span class="pun">).</span><span class="pln">option</span><span class="pun">(</span><span class="str">"driver"</span><span class="pun">,</span><span class="str">"com.mysql.jdbc.Driver"</span><span class="pun">).</span><span class="pln">option</span><span class="pun">(</span><span class="str">"dbtable"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"student"</span><span class="pun">).</span><span class="pln">option</span><span class="pun">(</span><span class="str">"user"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"root"</span><span class="pun">).</span><span class="pln">option</span><span class="pun">(</span><span class="str">"password"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"hadoop"</span><span class="pun">).</span><span class="pln">load</span><span class="pun">()</span></li><li class="L1"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> jdbcDF</span><span class="pun">.</span><span class="pln">show</span><span class="pun">()</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Python</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>下面我们再来看一下如何往MySQL中写入数据。<br>
为了看到MySQL数据库在Spark程序执行前后发生的变化，我们先在Linux系统中新建一个终端，使用下面命令查看一下MySQL数据库中的数据库spark中的表student的内容：</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-bash prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="pln">service mysql start //如果前面已经启动MySQL数据库，这里不用再执行这条命令</span></li><li class="L1"><span class="pln">mysql -u root -p</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Shell 命令</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>执行上述命令后，屏幕上会提示你输入MySQL数据库密码，我们这里给数据库设置的用户是root，密码是hadoop。<br>
因为之前我们已经在MySQL数据库中创建了一个名称为spark的数据库，并创建了一个名称为student的表，现在查看一下：</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-mysql prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="pln">mysql</span><span class="pun">&gt;</span><span class="pln">  </span><span class="kwd">use</span><span class="pln"> spark</span><span class="pun">;</span></li><li class="L1"><span class="typ">Database</span><span class="pln"> changed</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="pln">mysql</span><span class="pun">&gt;</span><span class="pln"> </span><span class="kwd">select</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="kwd">from</span><span class="pln"> student</span><span class="pun">;</span></li><li class="L4"><span class="com">//上面命令执行后返回下面结果</span></li><li class="L5"><span class="pun">+------+----------+--------+------+</span></li><li class="L6"><span class="pun">|</span><span class="pln"> id   </span><span class="pun">|</span><span class="pln"> name     </span><span class="pun">|</span><span class="pln"> gender </span><span class="pun">|</span><span class="pln"> age  </span><span class="pun">|</span></li><li class="L7"><span class="pun">+------+----------+--------+------+</span></li><li class="L8"><span class="pun">|</span><span class="pln">    </span><span class="lit">1</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Xueqian</span><span class="pln">  </span><span class="pun">|</span><span class="pln"> F      </span><span class="pun">|</span><span class="pln">   </span><span class="lit">23</span><span class="pln"> </span><span class="pun">|</span></li><li class="L9"><span class="pun">|</span><span class="pln">    </span><span class="lit">2</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Weiliang</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> M      </span><span class="pun">|</span><span class="pln">   </span><span class="lit">24</span><span class="pln"> </span><span class="pun">|</span></li><li class="L0"><span class="pun">+------+----------+--------+------+</span></li><li class="L1"><span class="lit">2</span><span class="pln"> rows </span><span class="kwd">in</span><span class="pln"> </span><span class="kwd">set</span><span class="pln"> </span><span class="pun">(</span><span class="lit">0.00</span><span class="pln"> sec</span><span class="pun">)</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">mysql</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>现在我们开始在pyspark中编写程序，往spark.student表中插入两条记录。<br>
下面，我们要启动一个pyspark，而且启动的时候，要附加一些参数。启动pyspark时，必须指定mysql连接驱动jar包（如果你前面已经采用下面方式启动了pyspark，就不需要重复启动了）：</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-bash prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="kwd">cd </span><span class="pln">/usr/local/spark</span></li><li class="L1"><span class="pln">./bin/pyspark \</span></li><li class="L2"><span class="pln">--jars /usr/local/spark/jars/mysql-connector-java-5.1.40/mysql-connector-java-5.1.40-bin.jar \</span></li><li class="L3"><span class="pln">--driver-class-path  /usr/local/spark/jars/mysql-connector-java-5.1.40/mysql-connector-java-5.1.40-bin.jar</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Shell 命令</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>上面的命令行中，在一行的末尾加入斜杠\，是为了告诉spark-shell，命令还没有结束。</p>
<p>启动进入pyspark以后，可以执行以下命令连接数据库，写入数据，程序如下（你可以把下面程序一条条拷贝到pyspark中执行）</p>
<div class="code-pretty-container"><pre class="prettyprint linenums lang-python prettyprinted" style=""><ol class="linenums"><li class="L0"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="kwd">from</span><span class="pln"> pyspark</span><span class="pun">.</span><span class="pln">sql</span><span class="pun">.</span><span class="pln">types </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">Row</span></li><li class="L1"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="kwd">from</span><span class="pln"> pyspark</span><span class="pun">.</span><span class="pln">sql</span><span class="pun">.</span><span class="pln">types </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">StructType</span></li><li class="L2"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="kwd">from</span><span class="pln"> pyspark</span><span class="pun">.</span><span class="pln">sql</span><span class="pun">.</span><span class="pln">types </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">StructField</span></li><li class="L3"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="kwd">from</span><span class="pln"> pyspark</span><span class="pun">.</span><span class="pln">sql</span><span class="pun">.</span><span class="pln">types </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">StringType</span></li><li class="L4"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="kwd">from</span><span class="pln"> pyspark</span><span class="pun">.</span><span class="pln">sql</span><span class="pun">.</span><span class="pln">types </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">IntegerType</span></li><li class="L5"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> studentRDD </span><span class="pun">=</span><span class="pln"> spark</span><span class="pun">.</span><span class="pln">sparkContext</span><span class="pun">.</span><span class="pln">parallelize</span><span class="pun">([</span><span class="str">"3 Rongcheng M 26"</span><span class="pun">,</span><span class="str">"4 Guanhua M 27"</span><span class="pun">]).</span><span class="pln">map</span><span class="pun">(</span><span class="kwd">lambda</span><span class="pln"> line </span><span class="pun">:</span><span class="pln"> line</span><span class="pun">.</span><span class="pln">split</span><span class="pun">(</span><span class="str">" "</span><span class="pun">))</span></li><li class="L6"><span class="pun">//下面要设置模式信息</span></li><li class="L7"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> schema </span><span class="pun">=</span><span class="pln"> </span><span class="typ">StructType</span><span class="pun">([</span><span class="typ">StructField</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">StringType</span><span class="pun">(),</span><span class="pln"> </span><span class="kwd">True</span><span class="pun">),</span><span class="typ">StructField</span><span class="pun">(</span><span class="str">"gender"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">StringType</span><span class="pun">(),</span><span class="pln"> </span><span class="kwd">True</span><span class="pun">),</span><span class="typ">StructField</span><span class="pun">(</span><span class="str">"age"</span><span class="pun">,</span><span class="typ">IntegerType</span><span class="pun">(),</span><span class="pln"> </span><span class="kwd">True</span><span class="pun">)])</span></li><li class="L8"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> rowRDD </span><span class="pun">=</span><span class="pln"> studentRDD</span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="kwd">lambda</span><span class="pln"> p </span><span class="pun">:</span><span class="pln"> </span><span class="typ">Row</span><span class="pun">(</span><span class="pln">p</span><span class="pun">[</span><span class="lit">1</span><span class="pun">].</span><span class="pln">strip</span><span class="pun">(),</span><span class="pln"> p</span><span class="pun">[</span><span class="lit">2</span><span class="pun">].</span><span class="pln">strip</span><span class="pun">(),</span><span class="pln">int</span><span class="pun">(</span><span class="pln">p</span><span class="pun">[</span><span class="lit">3</span><span class="pun">])))</span></li><li class="L9"><span class="pun">//建立起</span><span class="typ">Row</span><span class="pun">对象和模式之间的对应关系，也就是把数据和模式对应起来</span></li><li class="L0"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> studentDF </span><span class="pun">=</span><span class="pln"> spark</span><span class="pun">.</span><span class="pln">createDataFrame</span><span class="pun">(</span><span class="pln">rowRDD</span><span class="pun">,</span><span class="pln"> schema</span><span class="pun">)</span></li><li class="L1"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> prop </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{}</span></li><li class="L2"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> prop</span><span class="pun">[</span><span class="str">'user'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'root'</span></li><li class="L3"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> prop</span><span class="pun">[</span><span class="str">'password'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'hadoop'</span></li><li class="L4"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> prop</span><span class="pun">[</span><span class="str">'driver'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">"com.mysql.jdbc.Driver"</span></li><li class="L5"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> studentDF</span><span class="pun">.</span><span class="pln">write</span><span class="pun">.</span><span class="pln">jdbc</span><span class="pun">(</span><span class="str">"jdbc:mysql://localhost:3306/spark"</span><span class="pun">,</span><span class="str">'student'</span><span class="pun">,</span><span class="str">'append'</span><span class="pun">,</span><span class="pln"> prop</span><span class="pun">)</span></li></ol></pre><div class="code-pretty-toolbar"><span class="title">Python</span><a href="javascript:void(0);" title="复制代码" class="tool clipboard"><i class="fa fa-files-o"></i></a><a href="javascript:void(0);" title="查看纯文本代码" class="tool view-source"><i class="fa fa-code"></i></a><a href="javascript:void(0);" title="返回代码高亮" class="tool back-to-pretty"><i class="fa fa-undo"></i></a><span class="msg"></span></div></div>
<p>在pyspark中执行完上述程序后，我们可以看一下效果，看看MySQL数据库中的spark.student表发生了什么变化。请在刚才的另外一个窗口的MySQL命令提示符下面继续输入下面命令：</p>
<pre><code>mysql&gt; select * from student;
+------+-----------+--------+------+
| id   | name      | gender | age  |
+------+-----------+--------+------+
|    1 | Xueqian   | F      |   23 |
|    2 | Weiliang  | M      |   24 |
|    3 | Rongcheng | M      |   26 |
|    4 | Guanhua   | M      |   27 |
+------+-----------+--------+------+
4 rows in set (0.00 sec)
</code></pre>
			</div><!-- .entry-content -->

	<footer class="entry-footer">
		<div class="entry-author">
			<div class="author-title">本文作者</div>
			
		<div class="author-avatar"><img src="4.6Spark2.1.0%E5%85%A5%E9%97%A8%EF%BC%9A%E9%80%9A%E8%BF%87JDBC%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93(DataFrame)(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/2.jpg" alt="阮榕城" class="avatar avatar-thumbnail wp-user-avatar wp-user-avatar-thumbnail alignnone photo"></div>
		<div class="author-info">
			<p class="author-name"><a href="http://dblab.xmu.edu.cn/blog/author/ruanrongcheng/">阮榕城</a></p>
			<p class="author-desc">磨人的小妖精！</p>
			<p class="author-contact"><a href="http://www.nekomiao.me/" target="_blank" title="个人主页" class="homepage"><i class="fa fa-home"></i>www.nekomiao.me</a><i class="fa fa-envelope"></i><span class="envelope">moc.qq@crnaur</span></p>
		</div>
			</div>
		<div class="entry-info">
			<span class="permalink"><i class="fa fa-external-link"></i> <a href="http://dblab.xmu.edu.cn/blog/1724-2/" title="Spark2.1.0入门：通过JDBC连接数据库(DataFrame)(Python版)">http://dblab.xmu.edu.cn/blog/1724-2/</a></span><span class="category"><i class="fa fa-folder-open-o"></i> <a href="http://dblab.xmu.edu.cn/blog/category/big-data/" rel="category tag">大数据</a></span>		</div>
		<div class="yarpp-related yarpp-related-none">
</div>
	</footer><!-- .entry-footer -->
</article><!-- #post-## -->
			</div>
</div><!-- .row -->

	<div class="row">
		<div class="col-sm-3"></div>
		<div class="col-sm-9 site-footer">
			© 2014 <a href="http://dblab.xmu.edu.cn/">厦大数据库实验室</a>
					</div>
	</div>
</div><!-- .container -->
<link rel="stylesheet" id="yarppRelatedCss-css" href="4.6Spark2.1.0%E5%85%A5%E9%97%A8%EF%BC%9A%E9%80%9A%E8%BF%87JDBC%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93(DataFrame)(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/related.css" type="text/css" media="all">
<script type="text/javascript" src="4.6Spark2.1.0%E5%85%A5%E9%97%A8%EF%BC%9A%E9%80%9A%E8%BF%87JDBC%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93(DataFrame)(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/prettify.js"></script>
<script type="text/javascript" src="4.6Spark2.1.0%E5%85%A5%E9%97%A8%EF%BC%9A%E9%80%9A%E8%BF%87JDBC%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93(DataFrame)(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/power.js"></script>
<script type="text/javascript" src="4.6Spark2.1.0%E5%85%A5%E9%97%A8%EF%BC%9A%E9%80%9A%E8%BF%87JDBC%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93(DataFrame)(Python%E7%89%88)_%E5%8E%A6%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%8D%9A%E5%AE%A2_files/wp-embed.js"></script>

<div class="back-to-top" id="back-to-top" title="嗖的就上去了！" style="display: block;"><span><i class="fa fa-chevron-up"></i></span></div></body></html>